<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>Ø³Ù†Ø§Ø±ÛŒÙˆ Û³ â€“ Ù…Ø³ÛŒØ± ØªÙÚ©ÛŒÚ© Ø¯Ø± Ù…Ø¨Ø¯Ø£</title>
<script src="game-core.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@500;600;700;800&display=swap" rel="stylesheet">

  <style>
    @font-face{ font-family:"Yekan"; src: local("Yekan"), local("IRYekan"); }
    *{ box-sizing:border-box; }

    body{
      margin:0; padding:0;
      font-family:Yekan, sans-serif;
      background: #071016 url("letter1.png") center/130% no-repeat fixed;
      color:#fff;
      overflow:hidden;
    }

    .overlay{
      position:fixed; inset:0;
      background: radial-gradient(circle at top, rgba(255,255,255,0.05), rgba(0,0,0,0.78));
      z-index:0;
    }

    /* Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„Ø§ (Ø«Ø§Ø¨ØªØŒ Ø¨Ø¯ÙˆÙ† Ø§ÛŒÙ†Ú©Ù‡ Ú†ÛŒØ²ÛŒ Ø±Ø§ Ù‡Ù„ Ø¨Ø¯Ù‡Ø¯) */
    .top-bar{
      position:fixed;
      top: 20px;
      left:50%;
      transform:translateX(-50%);
      z-index:70;
      font-size: 22px;
      font-weight: 900;
      color:#fff;
      text-shadow: 0 10px 26px rgba(0,0,0,0.9);
      pointer-events:none;
      font-family:"Nunito", sans-serif;
    }

    /* â­ Stars (10) */
    .stars-box{
      position:fixed;
      top: 80px;
      left:50%;
      transform:translateX(-50%);
      display:flex;
      gap:6px;
      z-index:60;
      pointer-events:none;
    }
    .star{
      width:26px; height:26px;
      background:url("star-off.png") center/contain no-repeat;
      opacity:.45;
      transition: opacity .25s, transform .25s;
    }
    .star.active{
      background:url("star-on.png") center/contain no-repeat;
      opacity:1;
      transform:scale(1.22);
      filter: drop-shadow(0 0 6px #ffeb3b);
    }

    /* â³ Timer */
    .timer-box{
      position:fixed;
      top:20px; left:20px;
      display:flex;
      align-items:center;
      gap:12px;
      padding:10px 20px;
      background: rgba(2,6,23,0.80);
      border-radius:20px;
      border:1px solid rgba(255,255,255,0.18);
      box-shadow: 0 8px 30px rgba(0,0,0,0.65);
      z-index:60;
      backdrop-filter: blur(8px);
    }
    .hourglass{ font-size:34px; animation: flip 2s infinite linear; }
    .time-text{
      font-family:"Nunito", sans-serif;
      font-size:34px;
      font-weight:800;
      letter-spacing:1px;
      color:#fff;
    }
    .timer-warning .time-text{ color:#ef4444; }
    @keyframes flip{
      0%{ transform: rotate(0deg); }
      50%{ transform: rotate(180deg); }
      100%{ transform: rotate(360deg); }
    }

    /* ØµØ­Ù†Ù‡ Ø¨Ø§Ø²ÛŒ */
    .scene{
      position:relative;
      z-index:1;
      width:100vw;
      height:100vh;
    }

    /* Ø²Ù…ÛŒÙ† Ø¨Ø§Ø²ÛŒ (Û³ Ù„Ø§ÛŒÙ†) */
    .arena{
      position:absolute;
      left:0; right:0;
      top: 130px;              /* Ø²ÛŒØ± ØªØ§ÛŒÙ…Ø±/Ø³ØªØ§Ø±Ù‡â€ŒÙ‡Ø§ */
      bottom: 110px;           /* Ø¬Ø§ Ø¨Ø±Ø§ÛŒ Ù¾Ù†Ù„ Ø¢Ø±ÛŒØ§ */
      margin: 0 auto;
      width: min(1100px, 96vw);
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.20);
      backdrop-filter: blur(6px);
      box-shadow: 0 18px 46px rgba(0,0,0,0.85);
      overflow:hidden;
    }

    .lanes{
      position:absolute; inset:0;
      display:grid;
      grid-template-rows: 1fr 1fr 1fr;
    }
    .lane{
      position:relative;
      border-top: 1px dashed rgba(255,255,255,0.10);
    }
    .lane:first-child{ border-top:none; }

    /* Ø±Ø§Ù‡ (Ø®Ø· Ø­Ø±Ú©Øª) */
    .lane::after{
      content:"";
      position:absolute;
      left:0; right:0;
      top:50%;
      height:2px;
      transform:translateY(-50%);
      background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.16), rgba(255,255,255,0.06));
      opacity: .55;
    }
/* Ù‡Ø± Ù„Ø§ÛŒÙ† Ù…Ø«Ù„ Ø¬Ø§Ø¯Ù‡ */
.lane{
  position: relative;
  overflow: hidden;
  border-top: 1px solid rgba(255,255,255,0.06);
  background:
    /* Ø¨Ø§ÙØª Ø¯Ø§Ù†Ù‡â€ŒØ§ÛŒ Ø®ÛŒÙ„ÛŒ Ø¸Ø±ÛŒÙ */
    radial-gradient(circle at 20% 30%, rgba(255,255,255,0.05) 0 1px, transparent 2px),
    radial-gradient(circle at 70% 60%, rgba(255,255,255,0.04) 0 1px, transparent 2px),
    radial-gradient(circle at 40% 80%, rgba(255,255,255,0.03) 0 1px, transparent 2px),
    /* Ú¯Ø±Ø§Ø¯ÛŒØ§Ù† Ø¢Ø³ÙØ§Ù„Øª */
    linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.10));
  background-size: 140px 140px, 160px 160px, 180px 180px, 100% 100%;
}

/* Ø®Ø·â€ŒÚ©Ø´ÛŒ ÙˆØ³Ø· (Ø®Ø·â€ŒÚ†ÛŒÙ†) */
.lane::after{
  content:"";
  position:absolute;
  left: 0;
  right: 0;
  top: 50%;
  height: 4px;
  transform: translateY(-50%);
  opacity: .75;

  /* Ø®Ø·â€ŒÚ†ÛŒÙ† */
  background:
    repeating-linear-gradient(
      90deg,
      rgba(255,255,255,0.00) 0 18px,
      rgba(255, 255, 255, 0.4) 18px 42px,
      rgba(255,255,255,0.00) 42px 60px
    );
  filter: drop-shadow(0 2px 2px rgba(0,0,0,0.45));
}

/* Ø´Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø§Ø¯Ù‡ (Ù„Ø¨Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù„Ø§/Ù¾Ø§ÛŒÛŒÙ†) */
.lane::before{
  content:"";
  position:absolute;
  inset: 0;
  pointer-events:none;

  background:
    linear-gradient(to bottom,
      rgba(255,255,255,0.10) 0px,
      rgba(255,255,255,0.02) 8px,
      rgba(0,0,0,0.00) 12px,
      rgba(0,0,0,0.00) calc(100% - 12px),
      rgba(255,255,255,0.02) calc(100% - 8px),
      rgba(255,255,255,0.10) 100%
    );
  opacity: .75;
}

/* Ø®Ø· Ø¬Ø¯Ø§Ú©Ù†Ù†Ø¯Ù‡ Ø¨ÛŒÙ† Ù„Ø§ÛŒÙ†â€ŒÙ‡Ø§ */
.lane:first-child{ border-top: none; }

    /* Ú©Ø§Ù…ÛŒÙˆÙ†/Ø¢Ø¯Ù…Ú© Ø«Ø§Ø¨Øª Ø¯Ø± Ø³Ù…Øª Ú†Ù¾ */
    .player{
  position:absolute;
  left: 36px;

  width: 140px;     /* Ù‚Ø§Ø¨Ù„ ØªØºÛŒÛŒØ± */
  height: 90px;

  background: none;
  border: none;
  box-shadow: none;
  border-radius: 0;

  display:flex;
  align-items:center;
  justify-content:center;

  transform: translateY(-50%);
  z-index: 5;
  pointer-events: none;
}
    .player .emoji{ font-size: 80px; }

    /* Ú©Ø§Ø±Øª/ØªØ§Ø¨Ù„Ùˆ ÙˆØ±ÙˆØ¯ÛŒ (Ø§Ø² Ø±Ø§Ø³Øª Ù…ÛŒâ€ŒØ¢ÛŒØ¯) */
    .gate{
  position:absolute;
  right: 0;                 /* Ù…Ø§ Ø¨Ø§ JS Ù…Ù‚Ø¯Ø§Ø± right Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… */
  height: 58px;
  border-radius: 16px;
  padding: 10px 14px;
  display: inline-flex;     /* Ù…Ù‡Ù… */
  align-items:center;
  gap: 12px;
  width: fit-content;       /* Ù…Ù‡Ù… */
  max-width: min(760px, 78vw);
  box-sizing: border-box;
  border: 1px solid rgba(255,255,255,0.16);
  background: rgba(0,0,0,0.55);
  box-shadow: 0 18px 36px rgba(0,0,0,0.85);
  backdrop-filter: blur(10px);
  transform: translateY(-50%);
  top: 50%;
  z-index: 4;
}

    .gate .badge{
      width: 38px;
      height: 38px;
      border-radius: 12px;
      display:grid;
      place-items:center;
      font-size: 20px;
      flex-shrink:0;
      border:1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.08);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.25);
    }
    .gate .text{
  font-family:"Nunito", sans-serif;
  font-weight: 800;
  font-size: 16px;
  line-height: 1.6;
  white-space: nowrap;      /* Ù…Ù‡Ù…: Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø¯Ù‚ÛŒÙ‚ Ø·ÙˆÙ„ Ø¬Ù…Ù„Ù‡ */
}

    /* Ù„Ø§ÛŒÙ† Ø§Ù†ØªØ®Ø§Ø¨ÛŒ: Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ø¸Ø±ÛŒÙ */
   .lane.selected{
  box-shadow: inset 0 0 0 2px rgba(184,255,122,0.18);
  background:
    radial-gradient(circle at 50% 50%, rgba(184,255,122,0.10), rgba(0,0,0,0.00) 60%),
    radial-gradient(circle at 20% 30%, rgba(255,255,255,0.05) 0 1px, transparent 2px),
    radial-gradient(circle at 70% 60%, rgba(255,255,255,0.04) 0 1px, transparent 2px),
    radial-gradient(circle at 40% 80%, rgba(255,255,255,0.03) 0 1px, transparent 2px),
    linear-gradient(180deg, rgba(255,255,255,0.08), rgba(0,0,0,0.10));
}


    /* Ú©Ù†ØªØ±Ù„ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
    .controls{
      position:fixed;
      right: 18px;
      bottom: 120px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      z-index:70;
    }
    .ctrl-btn{
      width: 62px;
      height: 62px;
      border-radius: 50%;
      border:none;
      background: rgba(255,255,255,0.14);
      color:#fff;
      font-size: 22px;
      box-shadow: 0 12px 22px rgba(0,0,0,0.75);
      backdrop-filter: blur(10px);
      cursor:pointer;
      user-select:none;
    }
    .ctrl-btn:active{ transform: translateY(1px); }

    /* Ù¾Ù†Ù„ Ø¢Ø±ÛŒØ§ Ù¾Ø§ÛŒÛŒÙ† ØµÙØ­Ù‡ */
    .aria-panel{
      position:fixed;
      left:22px;
      right:22px;
      bottom:16px;
      margin:0 auto;
      background: rgba(0,0,0,0.55);
      border-radius: 18px;
      padding: 8px 12px;
      backdrop-filter: blur(10px);
      box-shadow: 0 -10px 24px rgba(0,0,0,0.90);
      display:flex;
      align-items:flex-start;
      gap:8px;
      z-index:70;
    }
    .aria-panel.aria-flash{ animation: ariaFlash .6s ease-out; }
    @keyframes ariaFlash{
      0%{ box-shadow:0 -10px 24px rgba(160,255,130,0.0); transform: translateY(0); }
      50%{ box-shadow:0 -10px 32px rgba(160,255,130,0.55); transform: translateY(-2px); }
      100%{ box-shadow:0 -10px 24px rgba(160,255,130,0.0); transform: translateY(0); }
    }
    .aria-avatar{
      width:40px; height:40px;
      border-radius:50%;
      overflow:hidden;
      box-shadow: 0 0 10px rgba(0,0,0,0.8);
      flex-shrink:0;
    }
    .aria-avatar img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
    }
    .aria-bubble{
      flex:1;
      background: rgba(0,0,0,0.75);
      border-radius: 18px;
      padding: 8px 10px;
      border: 1px solid rgba(255,255,255,0.08);
      position:relative;
    }
    .aria-bubble::before{
      content:"";
      position:absolute;
      top: 14px;
      right: -8px;
      border-width: 6px 0 6px 8px;
      border-style: solid;
      border-color: transparent transparent transparent rgba(0,0,0,0.75);
    }
    .aria-name{
      font-size:11px;
      opacity:.85;
      color:#b8ff7d;
      margin-bottom: 3px;
      font-family:"Nunito", sans-serif;
      font-weight: 900;
    }
    .aria-text{
      font-family:"Nunito", sans-serif;
      font-size: 22px;
      font-weight: 700;
      line-height: 1.9;
      color:#fff;
    }
    .aria-text span.good{ color:#b8ff7d; }
    .aria-text span.bad{ color:#ffb5b5; }

    /* Ø´Ø±ÙˆØ¹ */
    .start-overlay{
      position:fixed;
      inset:0;
      background: radial-gradient(circle at top, rgba(0,0,0,0.70), rgba(0,0,0,0.95));
      z-index:90;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding: 0 18px;
    }
    .start-title{
      font-family:"Nunito", sans-serif;
      font-weight: 900;
      font-size: 22px;
      margin-bottom: 8px;
    }
    .start-desc{
      max-width: 620px;
      font-size: 14px;
      opacity:.92;
      line-height: 1.9;
      margin-bottom: 18px;
    }
    .btn{
      border-radius: 999px;
      border:none;
      padding: 10px 18px;
      font-size: 14px;
      cursor:pointer;
      box-shadow: 0 12px 22px rgba(0,0,0,0.9);
      transition: transform .18s ease, box-shadow .18s ease;
      font-family:"Nunito", sans-serif;
      font-weight: 800;
    }
    .btn:active{ transform: translateY(1px); box-shadow: 0 7px 14px rgba(0,0,0,0.85); }
    .btn-primary{
      background: linear-gradient(135deg,#b8ff6a,#46ff8f);
      color:#072313;
    }

    /* Ù¾Ø§ÛŒØ§Ù† */
    .end-backdrop{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,0.75);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:95;
    }
    .end-modal{
      background: rgba(0,0,0,0.90);
      border-radius: 22px;
      padding: 18px 22px;
      width: min(420px, 92vw);
      backdrop-filter: blur(16px);
      box-shadow: 0 22px 40px rgba(0,0,0,1);
      text-align:center;
      color:#fff;
    }
    .end-title{
      font-family:"Nunito", sans-serif;
      font-weight: 900;
      font-size: 18px;
      margin-bottom: 8px;
    }
    .end-text{
      font-family:"Nunito", sans-serif;
      font-weight: 700;
      font-size: 14px;
      line-height: 1.9;
      opacity:.98;
      margin-bottom: 16px;
    }

    @media (max-width: 760px){
      .gate{ width: min(520px, 74vw); }
      .aria-text{ font-size: 19px; }
      .controls{ right: 10px; bottom: 118px; }
    }
  </style>
</head>

<body>
  <div class="overlay"></div>

  <div class="top-bar"> Ù…Ø­Ù„ ØªÙÚ©ÛŒÚ© Ø¯Ø± Ù…Ø¨Ø¯Ø£</div>

  <!-- â­ Stars -->
<div class="stars-box" id="starsBox">
  <div class="star"></div>
  <div class="star"></div>
  <div class="star"></div>
</div>

  <!-- â³ Timer -->
  <div class="timer-box" id="timerBox">
    <span class="hourglass">â³</span>
    <span class="time-text" id="timeText">01:00</span>
  </div>

  <div class="scene">

    <!-- Ø²Ù…ÛŒÙ† Ø¨Ø§Ø²ÛŒ -->
    <div class="arena" id="arena">
      <div class="lanes" id="lanes">
        <div class="lane" data-lane="0"></div>
        <div class="lane" data-lane="1"></div>
        <div class="lane" data-lane="2"></div>
      </div>

      <!-- Ø¨Ø§Ø²ÛŒÚ©Ù† -->
      <div class="player" id="player">
        <span class="emoji">ğŸšš</span>
      </div>
    </div>

    <!-- Ú©Ù†ØªØ±Ù„ Ù…ÙˆØ¨Ø§ÛŒÙ„ -->
    <div class="controls">
      <button class="ctrl-btn" id="btnUp"   aria-label="Ø¨Ø§Ù„Ø§">â¬†ï¸</button>
      <button class="ctrl-btn" id="btnDown" aria-label="Ù¾Ø§ÛŒÛŒÙ†">â¬‡ï¸</button>
    </div>

    <!-- Ù¾Ù†Ù„ Ø¢Ø±ÛŒØ§ -->
    <div class="aria-panel" id="ariaPanel">
      <div class="aria-avatar">
        <img src="aria.png" alt="Ø¢Ø±ÛŒØ§">
      </div>
      <div class="aria-bubble">
        <div class="aria-name">Ø¢Ø±ÛŒØ§ â€“ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù¾Ø±Ø¯ÛŒØ³ Ø³Ø¨Ø²</div>
        <div class="aria-text" id="ariaText">
          Ú©Ø§Ù…ÛŒÙˆÙ† Ø±Ø§ Ø¨ÛŒÙ† Ø³Ù‡ Ù„Ø§ÛŒÙ† Ø¬Ø§Ø¨Ù‡â€ŒØ¬Ø§ Ú©Ù†. Ù‡Ø± ØªØ§Ø¨Ù„Ùˆ Ú©Ù‡ Ø±Ø³ÛŒØ¯ Ø§Ú¯Ø± Ù…Ø­Ù„Ù
          <span class="good">ØªÙÚ©ÛŒÚ© Ø¯Ø± Ù…Ø¨Ø¯Ø£</span> Ø¨ÙˆØ¯ØŒ Ø±ÙˆÛŒ Ù‡Ù…Ø§Ù† Ù„Ø§ÛŒÙ† Ø¨Ù…Ø§Ù† ØªØ§ â­ Ø¨Ú¯ÛŒØ±ÛŒ.
        </div>
      </div>
    </div>

  </div>

  <!-- Ø´Ø±ÙˆØ¹ -->
  <div class="start-overlay" id="startOverlay">
    <div class="start-title">Ù…Ø§Ù…ÙˆØ±ÛŒØª: Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­Ù„ Ø¯Ø±Ø³Øª ØªÙÚ©ÛŒÚ©</div>
    <div class="start-desc">
      ØªØ§Ø¨Ù„ÙˆÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø§Ø² Ø³Ù…Øª Ø±Ø§Ø³Øª ÙˆØ§Ø±Ø¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯. ÙÙ‚Ø· ØªØ§Ø¨Ù„ÙˆÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¨Ù‡
      <span class="good">ØªÙÚ©ÛŒÚ© Ø¯Ø± Ù…Ø¨Ø¯Ø£</span> Ù…Ø±Ø¨ÙˆØ·â€ŒØ§Ù†Ø¯ Ø§Ù…ØªÛŒØ§Ø² Ø¯Ø§Ø±Ù†Ø¯.
      Ø¨Ø§ÛŒØ¯ Ø¯Ø± Û¶Û° Ø«Ø§Ù†ÛŒÙ‡ØŒ <b>3 Ø³ØªØ§Ø±Ù‡</b> Ú©Ø§Ù…Ù„ Ú©Ù†ÛŒ.
      <br><br>
      Ú©Ù†ØªØ±Ù„: <b>â†‘/â†“</b> Ø¨Ø§ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ù…Øª Ø±Ø§Ø³Øª.
    </div>
    <button class="btn btn-primary" id="btnStart">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
  </div>

  <!-- Ù¾Ø§ÛŒØ§Ù† -->
  <div class="end-backdrop" id="endBackdrop">
    <div class="end-modal">
      <div class="end-title" id="endTitle">Ù¾Ø§ÛŒØ§Ù†</div>
      <div class="end-text" id="endText"></div>
      <button class="btn btn-primary" id="btnNext">Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ÛŒ</button>
    </div>
  </div>

<script>
    window.onerror = (m, s, l, c) => alert(`JS Error: ${m}\n${l}:${c}`);
/* =========================
   ØªÙ†Ø¸ÛŒÙ…Ø§Øª
========================= */
const TARGET_SCORE = 3;
const GAME_SECONDS = 60;

const LANES = 3;
const GATE_SPEED = 3.2;           // Ø³Ø±Ø¹Øª Ø­Ø±Ú©Øª ØªØ§Ø¨Ù„Ùˆ
const SPAWN_EVERY_MS = 1450;      // ÙØ§ØµÙ„Ù‡ ØªÙˆÙ„ÛŒØ¯ ØªØ§Ø¨Ù„Ùˆ
const HIT_X = 140;                // Ù†Ù‚Ø·Ù‡ Ø¹Ø¨ÙˆØ± Ø§Ø² Ø¬Ù„ÙˆÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù† (ØªÙ‚Ø±ÛŒØ¨Ø§Ù‹ Ù‡Ù…â€ŒØ±Ø§Ø³ØªØ§ Ø¨Ø§ Ú©Ø§Ù…ÛŒÙˆÙ†)

/* =========================
   ØµØ¯Ø§ (WebAudio Ù…Ø«Ù„ Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§)
========================= */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function ensureAudio(){ if (audioCtx.state === "suspended") audioCtx.resume().catch(()=>{}); }

function playCorrect(){
  ensureAudio();
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = "sine";
  o.frequency.setValueAtTime(520, audioCtx.currentTime);
  o.frequency.exponentialRampToValueAtTime(1400, audioCtx.currentTime + 0.18);
  g.gain.setValueAtTime(0.32, audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.22);
  o.connect(g).connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime + 0.22);
}

function playWrong(){
  ensureAudio();
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = "sawtooth";
  o.frequency.setValueAtTime(210, audioCtx.currentTime);
  g.gain.setValueAtTime(0.32, audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.25);
  o.connect(g).connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime + 0.25);
}

/* Ø¬ÛŒÙ†Ú¯ÙÙ„ Ú©ÙˆØªØ§Ù‡ Ù…ÙˆÙÙ‚ÛŒØª */
function playSuccess(){
  ensureAudio();
  const notes = [740, 980, 1240];
  notes.forEach((f,i)=>{
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = "triangle";
    o.frequency.setValueAtTime(f, audioCtx.currentTime + i*0.09);
    g.gain.setValueAtTime(0.0001, audioCtx.currentTime + i*0.09);
    g.gain.exponentialRampToValueAtTime(0.28, audioCtx.currentTime + i*0.09 + 0.02);
    g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + i*0.09 + 0.10);
    o.connect(g).connect(audioCtx.destination);
    o.start(audioCtx.currentTime + i*0.09);
    o.stop(audioCtx.currentTime + i*0.09 + 0.12);
  });
}

/* =========================
   Ø¯Ø§Ø¯Ù‡ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ (Ù‡Ù…Ø§Ù†â€ŒÙ‡Ø§)
========================= */
const PLATFORM_TYPES = { GOOD:"good", MEH:"meh", BAD:"bad" };

const specs = [
  { text:"Ø¢Ø´Ù¾Ø²Ø®Ø§Ù†Ù‡ Ø®Ø§Ù†Ù‡ â€“ ØªÙÚ©ÛŒÚ© Ø¯Ø± Ù…Ø¨Ø¯Ø£", type: PLATFORM_TYPES.GOOD },
  { text:"Ù…Ø­Ù„ ØªÙˆÙ„ÛŒØ¯ Ø²Ø¨Ø§Ù„Ù‡ Ø¯Ø± Ø±Ø³ØªÙˆØ±Ø§Ù† (Ù¾Ø´Øª ØµØ­Ù†Ù‡)", type: PLATFORM_TYPES.GOOD },
  { text:"Ù…Ø¨Ø¯Ø§ ØªÙˆÙ„ÛŒØ¯ Ø²Ø¨Ø§Ù„Ù‡", type: PLATFORM_TYPES.GOOD },
  { text:"Ø§ØªØ§Ù‚ ØªÙÚ©ÛŒÚ© Ø¯Ø§Ø®Ù„ÛŒ Ø¨ÛŒÙ…Ø§Ø±Ø³ØªØ§Ù† (Ù‚Ø¨Ù„ Ø§Ø² Ø®Ø±ÙˆØ¬ Ù¾Ø³Ù…Ø§Ù†Ø¯)", type: PLATFORM_TYPES.GOOD },

  { text:"Ù…Ø­Ù„ Ø¯ÙÙ† Ø²Ø¨Ø§Ù„Ù‡ ", type: PLATFORM_TYPES.BAD },
  { text:"Ú©Ù†Ø§Ø± Ø±ÙˆØ¯Ø®Ø§Ù†Ù‡ Ùˆ Ù…Ø³ÛŒÙ„â€ŒÙ‡Ø§", type: PLATFORM_TYPES.BAD },
  { text:"Ù…Ø®Ø§Ø²Ù† Ø²Ø¨Ø§Ù„Ù‡ Ù†ØµØ¨ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ø´Ù‡Ø±Ø¯Ø§Ø±ÛŒ", type: PLATFORM_TYPES.BAD },
  { text:"Ø§ÛŒØ³ØªÚ¯Ø§Ù‡ Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§ÙØª Ø´Ù‡Ø±Ø¯Ø§Ø±ÛŒ", type: PLATFORM_TYPES.BAD }
];

/* =========================
   DOM
========================= */
const arena       = document.getElementById("arena");
const lanesEl     = document.getElementById("lanes");
const laneEls     = Array.from(document.querySelectorAll(".lane"));
const playerEl    = document.getElementById("player");

const ariaPanel   = document.getElementById("ariaPanel");
const ariaText    = document.getElementById("ariaText");

const stars       = Array.from(document.querySelectorAll("#starsBox .star"));

const timerBox    = document.getElementById("timerBox");
const timeText    = document.getElementById("timeText");

const startOverlay= document.getElementById("startOverlay");
const btnStart    = document.getElementById("btnStart");

const endBackdrop = document.getElementById("endBackdrop");
const endTitle    = document.getElementById("endTitle");
const endText     = document.getElementById("endText");
const btnNext     = document.getElementById("btnNext");

const btnUp       = document.getElementById("btnUp");
const btnDown     = document.getElementById("btnDown");

/* =========================
   ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ
========================= */
let currentLane = 0;            // 0..2
let score = 0;
let gameEnded = false;

let timeLeft = GAME_SECONDS;
let timerInterval = null;

let spawnInterval = null;
let activeGates = [];           // {el, lane, type, x, hit}
const GAP_PX = 40;   // ÙØ§ØµÙ„Ù‡ Ø§Ù…Ù† Ø¨ÛŒÙ† Ø¯Ùˆ ØªØ§Ø¨Ù„Ùˆ Ø¯Ø± ÛŒÚ© Ù„Ø§ÛŒÙ†
const SAFE_OUTSIDE = 60; // Ú†Ù‚Ø¯Ø± Ø¨ÛŒØ±ÙˆÙ† Ø§Ø² Ù„Ø¨Ù‡ Ø±Ø§Ø³Øª Ø´Ø±ÙˆØ¹ Ú©Ù†Ø¯

/* =========================
   Ú©Ù…Ú©â€ŒØªØ§Ø¨Ø¹ UI
========================= */
function animateAria(){
  ariaPanel.classList.remove("aria-flash");
  void ariaPanel.offsetWidth;
  ariaPanel.classList.add("aria-flash");
}

function setAria(html){
  ariaText.innerHTML = html;
  animateAria();
}
function setLane(lane){
  currentLane = Math.max(0, Math.min(LANES - 1, lane));

  const pct = ((currentLane + 0.5) / LANES) * 100;
  playerEl.style.top = pct + "%";

  laneEls.forEach(el => el.classList.remove("selected"));
  laneEls[currentLane].classList.add("selected");
}


function activateStar(){
  if (score >= TARGET_SCORE) return;
  stars[score].classList.add("active");
  score++;
  if (score >= TARGET_SCORE) endGame(true);
}

/* =========================
   ØªØ§ÛŒÙ…Ø±
========================= */
function updateTimerUI(){
  const m = String(Math.floor(timeLeft/60)).padStart(2,"0");
  const s = String(timeLeft%60).padStart(2,"0");
  timeText.textContent = `${m}:${s}`;
}

function startTimer(){
  clearInterval(timerInterval);
  timeLeft = GAME_SECONDS;
  timerBox.classList.remove("timer-warning");
  updateTimerUI();

  timerInterval = setInterval(()=>{
    if (gameEnded) { clearInterval(timerInterval); return; }
    timeLeft--;
    updateTimerUI();
    if (timeLeft <= 10) timerBox.classList.add("timer-warning");
    if (timeLeft <= 0) endGame(false);
  }, 1000);
}

/* =========================
   ØªÙˆÙ„ÛŒØ¯ ØªØ§Ø¨Ù„ÙˆÙ‡Ø§
   - Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¨Ø§Ø²ÛŒ Ù…Ù†ØµÙ Ø¨Ø§Ø´Ø¯: Ø§Ø­ØªÙ…Ø§Ù„ GOOD Ø¨ÛŒØ´ØªØ± Ø§Ø³Øª
========================= */
function pickSpec(){
  const r = Math.random();

  if (r < 0.65) {
    const goods = specs.filter(s => s.type === PLATFORM_TYPES.GOOD);
    return goods[Math.floor(Math.random() * goods.length)];
  } else {
    const bads = specs.filter(s => s.type === PLATFORM_TYPES.BAD);
    return bads[Math.floor(Math.random() * bads.length)];
  }
}

function makeGate(){
  const lane = Math.floor(Math.random() * LANES);
  const spec = pickSpec();

  const gate = document.createElement("div");
  gate.className = `gate ${spec.type}`;

  const badge = document.createElement("div");
  badge.className = "badge";
  badge.textContent = (spec.type === PLATFORM_TYPES.GOOD) ? "â­" : (spec.type === PLATFORM_TYPES.MEH ? "â­" : "â­");

  const text = document.createElement("div");
  text.className = "text";
  text.textContent = spec.text;

  gate.appendChild(badge);
  gate.appendChild(text);

  laneEls[lane].appendChild(gate);
  gate.style.top = "50%";
  gate.style.transform = "translateY(-50%)";

  // Ø¹Ø±Ø¶ ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ø¹Ø¯ Ø§Ø² Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† Ø¨Ù‡ DOM
  const gateW = Math.ceil(gate.getBoundingClientRect().width);

  // "Ø¯ÙÙ…" Ù„Ø§ÛŒÙ†: Ø¹Ù‚Ø¨â€ŒØªØ±ÛŒÙ† (Ù…Ù†ÙÛŒâ€ŒØªØ±ÛŒÙ†) right Ø¨ÛŒÙ† gate Ù‡Ø§ÛŒ Ù‡Ù…Ø§Ù† Ù„Ø§ÛŒÙ†
  const laneGates = activeGates.filter(g => g.lane === lane);
  const tailX = laneGates.length ? Math.min(...laneGates.map(g => g.x)) : null;

  // Ø´Ø±ÙˆØ¹ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø¨ÛŒØ±ÙˆÙ† ØµÙØ­Ù‡
  let startX = -gateW - SAFE_OUTSIDE;

  // Ø§Ú¯Ø± Ø¯Ø± Ù‡Ù…ÛŒÙ† Ù„Ø§ÛŒÙ† gate Ø¯Ø§Ø±ÛŒÙ…ØŒ Ø§ÛŒÙ† ÛŒÚ©ÛŒ Ø±Ø§ Ù¾Ø´ØªÙ Ø¢Ù† Ø¨Ú†ÛŒÙ† (Ù…Ù†ÙÛŒâ€ŒØªØ±)
  if (tailX !== null) {
    startX = Math.min(startX, tailX - gateW - GAP_PX);
  }

  gate.style.right = startX + "px";

  return { el: gate, lane, type: spec.type, x: startX, hit:false, w: gateW };
}

function startSpawning(){
  clearInterval(spawnInterval);
  spawnInterval = setInterval(()=>{
    if (gameEnded) return;
    const g = makeGate();
    activeGates.push(g);
  }, SPAWN_EVERY_MS);
}

/* =========================
   Ø­Ù„Ù‚Ù‡ Ø­Ø±Ú©Øª Ùˆ Ø¨Ø±Ø®ÙˆØ±Ø¯
========================= */
function updateGates(){
  if (gameEnded) return;

  const arenaW = arena.getBoundingClientRect().width;

  for (const g of activeGates){
    // x ÛŒØ¹Ù†ÛŒ right Ø¨Ù‡ px (Ø§Ø² Ù…Ù†ÙÛŒ Ø¨Ù‡ Ø³Ù…Øª Ù…Ø«Ø¨Øª Ù…ÛŒâ€ŒØ±Ù‡: ÙˆØ§Ø±Ø¯ Ù…ÛŒØ´Ù‡ Ùˆ Ù…ÛŒâ€ŒØ±Ù‡ Ú†Ù¾ØŸ)
    // Ú†ÙˆÙ† gate Ø¨Ø§ "right" Ú©Ù†ØªØ±Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯: Ù‡Ø±Ú†Ù‡ right Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø´ÙˆØ¯ØŒ Ø¨Ù‡ Ø³Ù…Øª Ú†Ù¾ Ù…ÛŒâ€ŒØ¢ÛŒØ¯.
    g.x += GATE_SPEED;
    g.el.style.right = g.x + "px";
    // Ù†Ù‚Ø·Ù‡ Ø¨Ø±Ø®ÙˆØ±Ø¯: ÙˆÙ‚ØªÛŒ ØªØ§Ø¨Ù„Ùˆ Ø¨Ù‡ Ø¬Ù„ÙˆÛŒ Ú©Ø§Ù…ÛŒÙˆÙ† Ø±Ø³ÛŒØ¯
    // Ú©Ø§Ù…ÛŒÙˆÙ† Ø­Ø¯ÙˆØ¯ 36px Ø§Ø² Ú†Ù¾ Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ right-basedØŒ Ø¬Ù„ÙˆÛŒ Ú©Ø§Ù…ÛŒÙˆÙ† Ø±Ø§ Ø¨Ù‡ px ØªÙ‚Ø±ÛŒØ¨ÛŒ ØªØ¨Ø¯ÛŒÙ„ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…:
    // xHitFromRight â‰ˆ arenaW - HIT_X
    const xHitFromRight = arenaW - HIT_X;

    if (!g.hit && g.x >= xHitFromRight) {
      g.hit = true;
      evaluateGate(g);
    }
  }

  // Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ ØªØ§Ø¨Ù„ÙˆÙ‡Ø§ÛŒ Ø®Ø§Ø±Ø¬â€ŒØ´Ø¯Ù‡ (ÙˆÙ‚ØªÛŒ Ø®ÛŒÙ„ÛŒ Ø¬Ù„Ùˆ Ø±ÙØªÙ†Ø¯)
  activeGates = activeGates.filter(g=>{
    const off = g.x > arenaW + 800;
    if (off) { g.el.remove(); return false; }
    return true;
  });

  requestAnimationFrame(updateGates);
}

function evaluateGate(g){
  // ÙÙ‚Ø· ÙˆÙ‚ØªÛŒ Ù„Ø§ÛŒÙ†â€ŒÙ‡Ø§ ÛŒÚ©ÛŒ Ø¨Ø§Ø´Ø¯ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯.
  if (g.lane !== currentLane) {
    // Ø§Ú¯Ø± ØªØ§Ø¨Ù„Ùˆ Ø§Ø² Ù„Ø§ÛŒÙ† Ø¯ÛŒÚ¯Ø± Ø±Ø¯ Ø´Ø¯: Ù‡ÛŒÚ† Ú©Ø§Ø±ÛŒ Ù†Ú©Ù† (Ù†Ù‡ ØµØ­ÛŒØ­/ØºÙ„Ø·)
    return;
  }

  // Ø§Ú¯Ø± Ø±ÙˆÛŒ Ù‡Ù…Ø§Ù† Ù„Ø§ÛŒÙ† Ø¨ÙˆØ¯:
  if (g.type === PLATFORM_TYPES.GOOD) {
    playCorrect();
    activateStar();
    setAria(`<span class="good">Ø¢ÙØ±ÛŒÙ†!</span> Ø§ÛŒÙ† ÛŒÚ© Ù…Ø­Ù„Ù <b>ØªÙÚ©ÛŒÚ© Ø¯Ø± Ù…Ø¨Ø¯Ø£</b> Ø¨ÙˆØ¯ Ùˆ Ù…Ø­Ù„ Ø¯Ø±Ø³Øª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯ÛŒ.`);

    // ÙÛŒØ¯ ØªØ§Ø¨Ù„Ùˆ
    g.el.style.transition = "opacity .25s ease, transform .25s ease";
    g.el.style.opacity = "0";
    g.el.style.transform = "translateY(-50%) scale(0.98)";
    setTimeout(()=>{ try{ g.el.remove(); }catch(e){} }, 260);

  } else if (g.type === PLATFORM_TYPES.MEH) {
    playWrong();
    setAria(`<span class="bad">Ù†Ù‡ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹â€¦</span> Ø§ÛŒÙ† Ú¯Ø²ÛŒÙ†Ù‡ Â«Ù…Ø¨Ø¯Ø£Â» Ù†ÛŒØ³Øª. Ø¯Ù†Ø¨Ø§Ù„ Ù…Ø­Ù„ ØªÙÚ©ÛŒÚ© <b>Ù‚Ø¨Ù„ Ø§Ø² Ø®Ø±ÙˆØ¬ Ù¾Ø³Ù…Ø§Ù†Ø¯</b> Ø§Ø² Ù…Ø­Ù„ ØªÙˆÙ„ÛŒØ¯ Ø¨Ø§Ø´.`);

  } else {
    playWrong();
    setAria(`<span class="bad">Ø§Ø´ØªØ¨Ø§Ù‡!</span> Ø§ÛŒÙ†Ø¬Ø§ Ù…Ø­Ù„ Ù…Ù†Ø§Ø³Ø¨ ØªÙÚ©ÛŒÚ© Ù†ÛŒØ³Øª. Ø¨Ù‡ Ø¬Ø§ÛŒ Â«Ø¯ÙØ¹/Ø±Ù‡Ø§Ø³Ø§Ø²ÛŒÂ»ØŒ Ø¨Ø§ÛŒØ¯ <b>ØªÙÚ©ÛŒÚ© Ø¯Ø± Ù…Ø¨Ø¯Ø£</b> Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯.`);
  }
}

/* =========================
   Ø°Ø®ÛŒØ±Ù‡ Ø§Ù…ØªÛŒØ§Ø² + Ù¾Ø§ÛŒØ§Ù†
========================= */
function saveFinalScore(){
  // Ø§Ù…ØªÛŒØ§Ø² Ù‡Ù…ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡
  localStorage.setItem("stage3Score", String(score));

  // Ø§Ù…ØªÛŒØ§Ø² Ú©Ù„ (Ø¬Ù…Ø¹ Ø´ÙˆÙ†Ø¯Ù‡)
const prevTotal = parseInt(localStorage.getItem("totalScore") || "0", 10);
localStorage.setItem("totalScore", String(prevTotal + score));


  // Ø¢Ø²Ø§Ø¯Ø³Ø§Ø²ÛŒ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ (Ù…Ø«Ù„ Ø§Ù„Ú¯ÙˆÛŒ Ù‚Ø¨Ù„ÛŒ)
  let p = JSON.parse(localStorage.getItem("stage1Progress") || "{}");
  p.s3 = true;
  p.s4 = true;
  localStorage.setItem("stage1Progress", JSON.stringify(p));
}

function endGame(won){
  if (gameEnded) return;
  gameEnded = true;

  clearInterval(timerInterval);
  clearInterval(spawnInterval);

  saveFinalScore();

  if (won){
    endTitle.textContent = "Ø¢ÙØ±ÛŒÙ†! â­";
    endText.innerHTML = `ØªÙˆ 3 Ø³ØªØ§Ø±Ù‡ Ø±Ø§ Ú©Ø§Ù…Ù„ Ú©Ø±Ø¯ÛŒ.<br>Ø§Ù…ØªÛŒØ§Ø² Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡: <b>${score}</b> Ø§Ø² 3<br>Ø§Ù…ØªÛŒØ§Ø² Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ âœ…`;
    playSuccess();
  } else {
    endTitle.textContent = "Ø²Ù…Ø§Ù† ØªÙ…Ø§Ù… Ø´Ø¯ â³";
    endText.innerHTML = `Ø²Ù…Ø§Ù† Ù…Ø±Ø­Ù„Ù‡ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯.<br>Ø§Ù…ØªÛŒØ§Ø² Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡: <b>${score}</b> Ø§Ø² 3<br>Ø§Ù…ØªÛŒØ§Ø² Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ âœ…`;
  }

  endBackdrop.style.display = "flex";
}

/* =========================
   Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§
========================= */
function handleMoveUp(){ if (!gameEnded) setLane(currentLane - 1); }
function handleMoveDown(){ if (!gameEnded) setLane(currentLane + 1); }

window.addEventListener("keydown",(e)=>{
  if (["ArrowUp","ArrowDown"].includes(e.key)) e.preventDefault();
  if (!startOverlay || startOverlay.style.display !== "none") return;

  if (e.key === "ArrowUp") handleMoveUp();
  if (e.key === "ArrowDown") handleMoveDown();
},{ passive:false });

btnUp.addEventListener("click", handleMoveUp);
btnDown.addEventListener("click", handleMoveDown);
btnUp.addEventListener("touchstart", (e)=>{ e.preventDefault(); handleMoveUp(); }, {passive:false});
btnDown.addEventListener("touchstart",(e)=>{ e.preventDefault(); handleMoveDown(); }, {passive:false});

/* =========================
   Ø´Ø±ÙˆØ¹/Ø±ÛŒØ³Øª
========================= */
function resetGame(){
  // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªØ§Ø¨Ù„ÙˆÙ‡Ø§
  activeGates.forEach(g=>{ try{ g.el.remove(); }catch(e){} });
  activeGates = [];

  // Ø±ÛŒØ³Øª Ø³ØªØ§Ø±Ù‡â€ŒÙ‡Ø§
  score = 0;
  stars.forEach(s=>s.classList.remove("active"));

  // Ø±ÛŒØ³Øª Ù„Ø§ÛŒÙ†
  setLane(0);

  gameEnded = false;
  timerBox.classList.remove("timer-warning");

  setAria(
    "Ú©Ø§Ù…ÛŒÙˆÙ† Ø±Ø§ Ø¨ÛŒÙ† Ø³Ù‡ Ù„Ø§ÛŒÙ† Ø¬Ø§Ø¨Ù‡â€ŒØ¬Ø§ Ú©Ù†. Ù‡Ø± ØªØ§Ø¨Ù„Ùˆ Ú©Ù‡ Ø±Ø³ÛŒØ¯ Ø§Ú¯Ø± Ù…Ø­Ù„Ù " +
    "<span class='good'>ØªÙÚ©ÛŒÚ© Ø¯Ø± Ù…Ø¨Ø¯Ø£</span> Ø¨ÙˆØ¯ØŒ Ø±ÙˆÛŒ Ù‡Ù…Ø§Ù† Ù„Ø§ÛŒÙ† Ø¨Ù…Ø§Ù† ØªØ§ â­ Ø¨Ú¯ÛŒØ±ÛŒ."
  );
}

function startGame(){
  // Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯Ù† ØµØ¯Ø§ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„
  ensureAudio();

  startOverlay.style.display = "none";
  resetGame();
  startTimer();
  startSpawning();
  requestAnimationFrame(updateGates);
}

btnStart.addEventListener("click", startGame);

/* Ø¯Ú©Ù…Ù‡ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ */
btnNext.addEventListener("click", ()=>{
  // Ø§ÛŒÙ† Ø¢Ø¯Ø±Ø³ Ø±Ø§ Ø¨Ø§ ÙØ§ÛŒÙ„ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ Ø®ÙˆØ¯Øª Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†
  window.location.href = "stage1-4.html";
});

/* Init Ø§ÙˆÙ„ÛŒÙ‡ */
setLane(0);
</script>

</body>
</html>
