3<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…Ø£Ù…ÙˆØ±ÛŒØª 6 â€“ ØªÙÚ©ÛŒÚ© Ù¾Ø³Ù…Ø§Ù†Ø¯Ù‡Ø§ÛŒ ØªØ± Ùˆ Ø®Ø´Ú© | Ù¾Ø±Ø¯ÛŒØ³ Ø³Ø¨Ø²</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@500;600;700&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="game-core.js"></script>
<style>
  @font-face {
    font-family: 'Yekan';
    src: local('Yekan'), local('IRYekan');
  }

  * { box-sizing: border-box; }

  body {
    margin: 0;
    font-family: Yekan, sans-serif;
    background: #0f172a;
    overflow-x: hidden;
    direction: rtl;
    color: #fff;
  }

  /* Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ */
  #bg {
    position: fixed;
    inset: 0;
    background: url('garbage.png') center/cover no-repeat;
    z-index: -2;
  }

  #overlay {
    position: fixed;
    inset: 0;
    background: radial-gradient(circle at top, #0008, #000e);
    z-index: -1;
  }

  
  .top-bar {
    padding: 14px 24px 4px;
    font-size: 22px;
    font-weight: bold;
    text-align: center;
  }

  .play-area {
    height: calc(100vh - 290px);
    display: flex;
    justify-content: center;
    gap: 70px;
    align-items: center;
  }

  .bin {
    width: 260px;
    height: 336px;   
    background: #1e293bcc;
    padding: 10px;
    border-radius: 22px;
    border: 2px solid #334155;
    text-align: center;
    box-shadow: 0 12px 30px #0009;
  }

  .bin.safe { border-color: #22c55e; }
  .bin.dry  { border-color: #3b82f6; }

.bin.safe img {
  height: 290px;
}

.bin.dry img {
  height: 330px;
}


  /* Ù†ÙˆØ§Ø± Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ */
  .items-bar {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: #020617ee;
  padding: 18px;
  border-top: 1px solid #1e293b;
  overflow-x: auto;
}

.items-row {
  display: flex;
  gap: 14px;
  overflow-x: auto;
  padding: 10px 5px;
  scroll-snap-type: x mandatory;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
    overflow-x: auto; /* Ø§Ø³Ú©Ø±ÙˆÙ„ Ø§ÙÙ‚ÛŒ ÙØ¹Ø§Ù„ */
}



  .item {
    scroll-snap-align: start;
  }

 .item {
  min-width: 110px;          /* Ù‚Ø¨Ù„Ø§Ù‹ Ú©ÙˆÚ†ÛŒÚ© Ù…ÛŒâ€ŒØ´Ø¯ */
  height: 110px;
  padding: 6px;
  flex-shrink: 0;            /* Ø§Ø¬Ø§Ø²Ù‡ Ù†Ù…ÛŒâ€ŒØ¯Ù‡ Ø¢ÛŒØªÙ… Ø±ÛŒØ² Ø´ÙˆØ¯ */
  display: flex;
  justify-content: center;
  align-items: center;
    flex-shrink: 0; 
}

  .item.drag { opacity: .8; transform: translateY(-8px) scale(1.05); }

.item img {
  width: 100px;
  height: 100px;
  object-fit: contain;
}


  .aria-box {
    position: fixed;
      bottom: 180px !important;
    left: 0;
    right: 0;
    margin: auto;
    width: 90%;
    max-width: 900px;
    background: #1e293bcc;
    padding: 12px 16px;
    border-radius: 18px;
    border: 1px solid #334155;
    box-shadow: 0 10px 30px #000a;
    font-size: 18px;
    z-index: 20;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .aria-name { color: #38bdf8; font-weight: bold; }

  .aria-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #3b82f6;
    box-shadow: 0 0 10px #0006;
  }

  /* Ø¨Ø§Ø²Ø®ÙˆØ±Ø¯ Ø¨Ø²Ø±Ú¯ âœ”ï¸ / âŒ */
  #feedback {
    position: fixed;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 80px;
    font-weight: 900;
    text-shadow: 0 0 20px #000, 0 0 40px #000;
    display: none;
    z-index: 999;
  }
  .stars-box {
  position: fixed;
  top: 70px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 8px;
  z-index: 30;
}

.star {
  width: 26px;
  height: 26px;
  background: url("star-off.png") center/contain no-repeat;
  opacity: .4;
  transition: .25s;
}

.star.active {
  background: url("star-on.png") center/contain no-repeat;
  opacity: 1;
  transform: scale(1.2);
  filter: drop-shadow(0 0 6px gold);
}


  /* Ù¾Ø§ÛŒØ§Ù† Ù…Ø±Ø­Ù„Ù‡ */
  #endPanel {
    display: none;
    position: fixed;
    inset: 0;
    background: #000c;
    align-items: center;
    justify-content: center;
    z-index: 30;
  }

  #endBox {
    background: #1e293b;
    border-radius: 20px;
    padding: 20px;
    text-align: center;
    width: 320px;
    border: 1px solid #334155;
  }

  #endBox h3 {
    margin-top: 0;
    margin-bottom: 10px;
  }

  #endBox button {
    margin-top: 12px;
    padding: 8px 18px;
    border-radius: 999px;
    border: none;
    background: #22c55e;
    color: #020617;
    font-weight: bold;
    cursor: pointer;
  }

  #endBox button:hover {
    transform: translateY(-1px);
  }
  /* Ù…ØªÙ† Ø¯Ø§Ø®Ù„ Ø¨Ø§Ú©Ø³ Ø¢Ø±ÛŒØ§ â€“ Ø¯Ø±Ø´Øªâ€ŒØªØ± Ùˆ Ø®ÙˆØ§Ù†Ø§ØªØ± */
.aria-text {
  font-family: "Nunito", sans-serif;
  font-size: 22px;
  font-weight: 700;
  line-height: 1.9;
  color: #ffffff;
}
@media screen and (orientation: landscape) {
  
  .play-area {
    height: 60vh;
    flex-direction: row;
    gap: 30px;
  }

.items-bar {
  position: fixed;
  bottom: 0;
  width: 100%;
  padding: 22px 18px;
  background:
    repeating-linear-gradient(
      90deg,
      #020617,
      #020617 24px,
      #020617 24px,
      #020617 48px
    );
  border-top: 3px solid #334155;
  box-shadow: inset 0 10px 20px #000a;
  z-index: 15;
}


  .item {
    min-width: 120px;
    height: 120px;
  }

  .item img {
    width: 110px;
    height: 110px;
  }

  .aria-box {
    bottom: 10px;
    width: 85%;
  }
}
.item.locked {
  opacity: 0.4;
  filter: grayscale(1);
  pointer-events: none;
}

.item.active {
  opacity: 1;
  filter: none;
  pointer-events: auto;
  cursor: grab;
}
.item.active {
  pointer-events: auto !important;
  cursor: grab;
  opacity: 1;
  filter: none;
}
.items-row {
  flex-direction: row-reverse;
}
.timer-box {
    position: fixed;
  top: 20px;
  left: 20px;
  transform: none;
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 20px;
  background: #020617cc;
  border-radius: 20px;
  border: 1px solid #334155;
  box-shadow: 0 8px 30px #000a;
  z-index: 40;
}

.hourglass {
  font-size: 34px;
  animation: flip 2s infinite linear;
}

.time-text {
  font-family: "Nunito", sans-serif;
  font-size: 34px;
  font-weight: 800;
  letter-spacing: 1px;
}

.timer-warning .time-text {
  color: #ef4444;
}

@keyframes flip {
  0%   { transform: rotate(0deg); }
  50%  { transform: rotate(180deg); }
  100% { transform: rotate(360deg); }
}


</style>
</head>

<body>

<div id="bg"></div>
<div id="overlay"></div>

<div class="top-bar"> ØªÙÚ©ÛŒÚ© Ù¾Ø³Ù…Ø§Ù†Ø¯Ù‡Ø§ÛŒ ØªØ± Ùˆ Ø®Ø´Ú©</div>
<div class="timer-box" id="timerBox">
  <span class="hourglass">â³</span>
  <span class="time-text" id="timeText">01:00</span>
</div>


<div class="stars-box" id="starsBox">
  <div class="star"></div><div class="star"></div><div class="star"></div>
  <div class="star"></div><div class="star"></div>
  <div class="star"></div><div class="star"></div><div class="star"></div>
  <div class="star"></div><div class="star"></div>
</div>


<div class="play-area">
  <div class="bin safe" data-type="wet">
    <div class="bin-title">Ø³Ø·Ù„ Ù¾Ø³Ù…Ø§Ù†Ø¯ ØªØ±</div>
    <img src="garbageg.png">
  </div>

  <div class="bin dry" data-type="dry">
    <div class="bin-title">Ø³Ø·Ù„ Ù¾Ø³Ù…Ø§Ù†Ø¯ Ø®Ø´Ú©</div>
    <img src="garbage0.png">
  </div>
</div>

<div class="aria-box">
  <img src="aria.png" class="aria-avatar" alt="Aria">
  <div>
   <span id="ariaText" class="aria-text">
  Ø³Ø¹ÛŒ Ú©Ù† Ù¾Ø³Ù…Ø§Ù†Ø¯ Ù‡Ø§ Ø±Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ø¯Ø± Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡ Ù…Ø®ØµÙˆØµ ØªÙÚ©ÛŒÚ© Ú©Ù†ÛŒ
</span>
  </div>
</div>

<div class="items-bar">
  <div class="items-row" id="itemsRow"></div>
</div>

<!-- Ø¨Ø§Ø²Ø®ÙˆØ±Ø¯ Ø¨Ø²Ø±Ú¯ -->
<div id="feedback"></div>

<div id="endPanel">
  <div id="endBox">
    <h3>Ù¾Ø§ÛŒØ§Ù† Ù…Ø±Ø­Ù„Ù‡</h3>
    <p id="endSummary"></p>
    <button onclick="location.reload()">Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>
    <button onclick="goHome()" style="
  margin-top: 10px;
  padding: 8px 18px;
  border-radius: 999px;
  border: none;
  background: #3b82f6;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</button>
  </div>
</div>

<script>
/* ============================================================
 ğŸµ Ø³ÛŒØ³ØªÙ… ØµØ¯Ø§ Ø¨Ø§ Web Audio API
============================================================ */

let audioCtx = new (window.AudioContext || window.webkitAudioContext)();

/* ØµØ¯Ø§ÛŒ Ø±Ù‡Ø§ Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Øª (Drop) */
function sfxDrop() {
  let o = audioCtx.createOscillator();
  let g = audioCtx.createGain();

  o.frequency.setValueAtTime(260, audioCtx.currentTime);
  o.frequency.exponentialRampToValueAtTime(180, audioCtx.currentTime + 0.1);

  g.gain.setValueAtTime(0.25, audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.12);

  o.connect(g).connect(audioCtx.destination);
  o.start();
  o.stop(audioCtx.currentTime + 0.14);
}

/* ØµØ¯Ø§ÛŒ Ú¯Ø±ÙØªÙ† Ú©Ø§Ø±Øª (Grab) */
function sfxGrab() {
  let o = audioCtx.createOscillator();
  let g = audioCtx.createGain();

  o.type = "sine";
  o.frequency.setValueAtTime(520, audioCtx.currentTime);
  o.frequency.exponentialRampToValueAtTime(680, audioCtx.currentTime + 0.07);

  g.gain.setValueAtTime(0.18, audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.08);

  o.connect(g).connect(audioCtx.destination);
  o.start();
  o.stop(audioCtx.currentTime + 0.1);
}

/* ØµØ¯Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø±Ø³Øª */
function sfxCorrect() {
  let o = audioCtx.createOscillator();
  let g = audioCtx.createGain();

  o.type = "triangle";
  o.frequency.setValueAtTime(420, audioCtx.currentTime);
  o.frequency.exponentialRampToValueAtTime(780, audioCtx.currentTime + 0.18);

  g.gain.setValueAtTime(0.25, audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.20);

  o.connect(g).connect(audioCtx.destination);
  o.start();
  o.stop(audioCtx.currentTime + 0.22);
}

/* ØµØ¯Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø´ØªØ¨Ø§Ù‡ */
function sfxWrong() {
  let o = audioCtx.createOscillator();
  let g = audioCtx.createGain();

  o.type = "square";
  o.frequency.setValueAtTime(160, audioCtx.currentTime);
  o.frequency.setValueAtTime(110, audioCtx.currentTime + 0.1);

  g.gain.setValueAtTime(0.3, audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.25);

  o.connect(g).connect(audioCtx.destination);
  o.start();
  o.stop(audioCtx.currentTime + 0.30);
}

/* ØµØ¯Ø§ÛŒ Ù¾Ø§ÛŒØ§Ù† Ù…Ø±Ø­Ù„Ù‡ */
function sfxComplete() {
  let now = audioCtx.currentTime;

  function note(freq, start, duration) {
    let osc = audioCtx.createOscillator();
    let gain = audioCtx.createGain();

    osc.type = "sine";
    osc.frequency.setValueAtTime(freq, now + start);

    gain.gain.setValueAtTime(0.22, now + start);
    gain.gain.exponentialRampToValueAtTime(0.0001, now + start + duration);

    osc.connect(gain).connect(audioCtx.destination);
    osc.start(now + start);
    osc.stop(now + start + duration);
  }

  note(440, 0.00, 0.25);
  note(660, 0.25, 0.25);
  note(880, 0.50, 0.30);
}

/* Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ */
let items = [
  // Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ØªØ±
  {img:"banana.png", type:"wet", label:"Ù¾ÙˆØ³Øª Ù…ÙˆØ²"},
  {img:"food.png", type:"wet", label:"ØºØ°Ø§"},
  {img:"leaf.png", type:"wet", label:"Ø¨Ø±Ú¯"},
  {img:"melon.png", type:"wet", label:"Ù‡Ù†Ø¯ÙˆØ§Ù†Ù‡"},
  {img:"orange.png", type:"wet", label:"Ù¾Ø±ØªÙ‚Ø§Ù„"},
  {img:"tomato.png", type:"wet", label:"Ú¯ÙˆØ¬Ù‡ Ù¾ÙˆØ³ÛŒØ¯Ù‡"},
  {img:"apple.png", type:"wet", label:"Ø³ÛŒØ¨"},
  {img:"rice2.png", type:"wet", label:"Ø¨Ø±Ù†Ø¬"},
  {img:"egg.png", type:"wet", label:"Ù¾ÙˆØ³Øª ØªØ®Ù…â€ŒÙ…Ø±Øº"},

  // Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø®Ø´Ú©
  {img:"wood.png", type:"dry", label:"Ú†ÙˆØ¨"},
  {img:"waste_paint_can.png", type:"dry", label:"Ù‚ÙˆØ·ÛŒ Ø±Ù†Ú¯"},
  {img:"bottle.png", type:"dry", label:"Ø¨Ø·Ø±ÛŒ Ù¾Ù„Ø§Ø³ØªÛŒÚ©"},
  {img:"box.png", type:"dry", label:"Ù…Ù‚ÙˆØ§"},
  {img:"cup.png", type:"dry", label:"Ù„ÛŒÙˆØ§Ù†"},
  {img:"plastic2.png", type:"dry", label:"Ú©ÛŒØ³Ù‡"},
  {img:"spoon.png", type:"dry", label:"Ù‚Ø§Ø´Ù‚ ÛŒÚ©Ø¨Ø§Ø±Ù…ØµØ±Ù"},
  {img:"glass.png", type:"dry", label:"Ø´ÛŒØ´Ù‡"},
  {img:"newspaper.png", type:"dry", label:"Ø±ÙˆØ²Ù†Ø§Ù…Ù‡"},
  {img:"foil.png", type:"dry", label:"ÙÙˆÛŒÙ„ Ø¢Ù„ÙˆÙ…ÛŒÙ†ÛŒÙˆÙ…"},
];

/* ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ø±Ø­Ù„Ù‡ Ø¢Ø®Ø±) */
let score = 0;                 // Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ (0 ØªØ§ 10)
const TARGET_SCORE = 10;       // Ù‡Ø¯Ù
let gameEnded = false;         // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú†Ù†Ø¯Ø¨Ø§Ø± Ù¾Ø§ÛŒØ§Ù† Ø¯Ø§Ø¯Ù†

/* Ø³Ø§Ø®Øª Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ */
const row      = document.getElementById("itemsRow");
const bins     = document.querySelectorAll(".bin");
const stars    = Array.from(document.querySelectorAll(".star"));
const feedback = document.getElementById("feedback");

let conveyor = [...items].sort(() => Math.random() - 0.5);
let currentItem = null;

function renderConveyor() {
  row.innerHTML = "";
  currentItem = null;

  conveyor.forEach((it, index) => {
    const card = document.createElement("div");
    card.className = "item locked";
    card.dataset.type = it.type;
    card.innerHTML = `<img src="${it.img}" alt="${it.label}" draggable="false">`;

    // ÙÙ‚Ø· Ø¢Ø®Ø±ÛŒÙ† Ø¢ÛŒØªÙ… ÙØ¹Ø§Ù„ Ø§Ø³Øª
    if (index === conveyor.length - 1) {
      card.classList.remove("locked");
      card.classList.add("active");
      card.draggable = true;
      currentItem = card;

      card.addEventListener("dragstart", (e) => {
        if (gameEnded) return;
        e.dataTransfer.setData("text/plain", "item");
        card.classList.add("drag");
        sfxGrab();
      });

      card.addEventListener("dragend", () => {
        card.classList.remove("drag");
      });
    }

    row.appendChild(card);
  });
}

/* Ø³ØªØ§Ø±Ù‡ + Ø§Ù…ØªÛŒØ§Ø² (Ø§ØµÙ„Ø§Ø­ Ø§ØµÙ„ÛŒ) */
function activateStar() {
  if (score >= stars.length) return;   // Ø­Ø¯Ø§Ú©Ø«Ø± 10 Ø³ØªØ§Ø±Ù‡
  stars[score].classList.add("active"); // Ø³ØªØ§Ø±Ù‡â€ŒÛŒ Ø´Ù…Ø§Ø±Ù‡â€ŒÛŒ score Ø±ÙˆØ´Ù† Ù…ÛŒâ€ŒØ´ÙˆØ¯
  score++;

  // Ø§Ú¯Ø± Ø¨Ù‡ Ù‡Ø¯Ù Ø±Ø³ÛŒØ¯ØŒ Ù…Ø±Ø­Ù„Ù‡ ØªÙ…Ø§Ù… Ø´ÙˆØ¯
  if (score >= TARGET_SCORE) {
    endGame(true);
  }
}

/* Ø¨Ø§Ø²Ø®ÙˆØ±Ø¯ Ø¨Ø²Ø±Ú¯ ÙˆØ³Ø· ØµÙØ­Ù‡ */
function showFeedback(symbol, color) {
  feedback.textContent = symbol;
  feedback.style.color = color;
  feedback.style.display = "block";
  setTimeout(() => feedback.style.display = "none", 600);
}

/* Ø¯Ø±Ø§Ù¾ Ø±ÙˆÛŒ Ø³Ø·Ù„â€ŒÙ‡Ø§ */
bins.forEach(bin => {
  bin.addEventListener("dragover", e => e.preventDefault());

  bin.addEventListener("drop", () => {
    if (gameEnded) return;
    if (!currentItem) return;

    const cType = currentItem.dataset.type;
    const bType = bin.dataset.type;

    if (cType === bType) {
      sfxCorrect();
      showFeedback("âœ”ï¸", "#22c55e");

      activateStar();     // â­ Ø§Ù…ØªÛŒØ§Ø² + Ø³ØªØ§Ø±Ù‡

      // ÙÙ‚Ø· Ø§Ú¯Ø± Ù‡Ù†ÙˆØ² Ø¨Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ù†Ø´Ø¯Ù‡ØŒ Ø¢ÛŒØªÙ… Ø±Ø§ Ø­Ø°Ù Ú©Ù† Ùˆ Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡
      if (!gameEnded) {
        conveyor.pop();
        if (conveyor.length === 0) {
          endGame(true);
        } else {
          renderConveyor();
        }
      }

    } else {
      sfxWrong();
      showFeedback("âŒ", "#ef4444");
      // âŒ Ù‡ÛŒÚ† Ø§Ù…ØªÛŒØ§Ø² Ù…Ù†ÙÛŒ
      // âŒ Ù‡ÛŒÚ† Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ
      // âŒ Ø¢ÛŒØªÙ… Ø­Ø°Ù Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯
    }
  });
});

/* ØªØ§ÛŒÙ…Ø± */
let timeLeft = 60;
let timerInterval = null;
const timeText = document.getElementById("timeText");
const timerBox = document.getElementById("timerBox");

function startTimer() {
  clearInterval(timerInterval);
  timeLeft = 60;
  timerBox.classList.remove("timer-warning");
  updateTimerUI();

  timerInterval = setInterval(() => {
    if (gameEnded) {
      clearInterval(timerInterval);
      return;
    }

    timeLeft--;
    updateTimerUI();

    if (timeLeft <= 10) timerBox.classList.add("timer-warning");

    if (timeLeft <= 0) {
      endGame(false); // Ù¾Ø§ÛŒØ§Ù† Ø²Ù…Ø§Ù†: Ù…Ø±Ø­Ù„Ù‡ ØªÙ…Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯ (Ø­ØªÛŒ Ø§Ú¯Ø± Ø§Ù…ØªÛŒØ§Ø² Ú©Ù… Ø¨Ø§Ø´Ø¯)
    }
  }, 1000);
}

function updateTimerUI() {
  const m = String(Math.floor(timeLeft / 60)).padStart(2, "0");
  const s = String(timeLeft % 60).padStart(2, "0");
  timeText.textContent = `${m}:${s}`;
}

/* Ø°Ø®ÛŒØ±Ù‡ Ø§Ù…ØªÛŒØ§Ø² (Ù…Ø±Ø­Ù„Ù‡ Ø¢Ø®Ø±) */
function saveFinalScore() {
  // Ø§Ú¯Ø± Ú©Ù„ Ø¨Ø§Ø²ÛŒ Ø§Ù…ØªÛŒØ§Ø² ØªØ¬Ù…Ø¹ÛŒ Ø¯Ø§Ø±Ø¯:
  // Ù…Ø«Ù„Ø§ Ù‚Ø¨Ù„Ø§Ù‹ "totalScore" Ø¯Ø§Ø´ØªÙ‡â€ŒØ§ÛŒØŒ Ø§ÛŒÙ†Ø¬Ø§ Ø¬Ù…Ø¹ Ù…ÛŒâ€ŒØ²Ù†ÛŒÙ…:
  const prevTotal = parseInt(localStorage.getItem("totalScore") || "0", 10);
  localStorage.setItem("totalScore", String(prevTotal + score));

  // Ùˆ Ø§Ù…ØªÛŒØ§Ø² Ù‡Ù…ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡:
  localStorage.setItem("stage7Score", String(score));
}

/* Ù¾Ø§ÛŒØ§Ù† Ù…Ø±Ø­Ù„Ù‡ (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡: Ø¨Ø¯ÙˆÙ† Ø±ÛŒØ³Øª) */
function endGame(won) {
  if (gameEnded) return;
  gameEnded = true;

  clearInterval(timerInterval);
  saveFinalScore();
  sfxComplete();

  document.getElementById("endPanel").style.display = "flex";
  const box = document.getElementById("endSummary");
  const title = document.querySelector("#endBox h3");

  // Ø¯Ú©Ù…Ù‡ Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¯Ø± Ù…Ø±Ø­Ù„Ù‡ Ø¢Ø®Ø± Ø¨ÛŒâ€ŒÙ…Ø¹Ù†ÛŒ Ø§Ø³Øª â†’ Ù…Ø®ÙÛŒ
  const reloadBtn = document.querySelector('#endBox button[onclick="location.reload()"]');
  if (reloadBtn) reloadBtn.style.display = "none";

  if (won) {
    title.textContent = "Ø¢ÙØ±ÛŒÙ†! Ù…Ø±Ø­Ù„Ù‡ Ø¢Ø®Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯ ğŸ‰";
    box.innerHTML = `
      Ø§Ù…ØªÛŒØ§Ø² Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡: <b>${score}</b> Ø§Ø² 10 â­<br>
      Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ âœ…
    `;
  } else {
    title.textContent = "Ø²Ù…Ø§Ù† ØªÙ…Ø§Ù… Ø´Ø¯ â³";
    box.innerHTML = `
      Ø²Ù…Ø§Ù† Ù…Ø±Ø­Ù„Ù‡ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯.<br>
      Ø§Ù…ØªÛŒØ§Ø² Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡: <b>${score}</b> Ø§Ø² 10 â­<br>
      Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ âœ…
    `;
  }
}

/* goHome Ø¨Ø§ÛŒØ¯ global Ø¨Ø§Ø´Ø¯ ØªØ§ onclick Ú©Ø§Ø± Ú©Ù†Ø¯ */
function goHome() {
  window.location.href = "stage2-1.html";
}

renderConveyor();
startTimer();
</script>

</body>
</html>
