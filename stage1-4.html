<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø³Ù†Ø§Ø±ÛŒÙˆ Û´ â€“ Ø¯ÛŒÙˆØ§Ø± Ø­Ù‚ÛŒÙ‚Øª Ø¨Ø§Ø²ÛŒØ§ÙØª</title>
  <script src="game-core.js"></script>
  <style>
    @font-face {
      font-family: "Yekan";
      src: local("Yekan"), local("IRYekan");
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: Yekan, sans-serif;
      direction: rtl;
      background: url("wall_bg.jpg") center/cover fixed no-repeat;
      overflow: hidden;
    }

    /* Ù„Ø§ÛŒÙ‡ ØªÛŒØ±Ù‡ Ù†Ø±Ù… Ø±ÙˆÛŒ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ */
    .backdrop {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, rgba(0,0,0,0.5), rgba(0,0,0,0.9));
      pointer-events: none;
      z-index: 0;
    }

    .game-root {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      z-index: 1;
    }

    /* HUD Ø¨Ø§Ù„Ø§ */
    .top-hud {
      position: absolute;
      top: 10px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
      z-index: 5;
      pointer-events: none;
    }

 


    .progress-label {
      margin-bottom: 3px;
      opacity: 0.9;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(255,255,255,0.18);
      border-radius: 999px;
      overflow: hidden;
    }

    .progress-fill {
      width: 0%;
      height: 100%;
      background: linear-gradient(90deg,#b8ff6a,#46ff8f);
      border-radius: inherit;
      transition: width 0.3s ease;
    }

    /* Ù…Ø­ÙˆØ·Ù‡ Ø¯ÛŒÙˆØ§Ø± */
    .wall-wrapper {
      position: absolute;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      width: min(1100px, 96vw);
      height: calc(100vh - 220px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1;
      pointer-events: none;
    }

    .wall-frame {
      position: relative;
      width: 100%;
      height: 100%;
      padding: 26px 32px;
      border-radius: 26px;
      background:
        linear-gradient(145deg, rgba(50,35,20,0.92), rgba(10,5,2,0.96));
      box-shadow:
        0 30px 60px rgba(0,0,0,0.95),
        inset 0 0 40px rgba(0,0,0,0.9);
      overflow: hidden;
      pointer-events: auto;
    }

    .wall-inner {
      position: relative;
      width: 100%;
      height: 100%;
      border-radius: 18px;
      padding: 18px 22px;
      background:
        radial-gradient(circle at top, rgba(110,90,70,0.6), rgba(20,14,10,0.95)),
        url("brick_texture.png") center/cover;
      box-shadow:
        inset 0 0 40px rgba(0,0,0,0.8),
        0 0 10px rgba(0,0,0,0.9);
      display: flex;
      flex-wrap: wrap;
      align-content: flex-start;
      gap: 18px;
    }

    .wall-frame::before {
      /* Ù‡Ø§Ù„Ù‡ Ù†ÙˆØ± Ø¨Ø§Ù„Ø§ÛŒ Ø¯ÛŒÙˆØ§Ø± */
      content: "";
      position: absolute;
      inset: -40px -90px auto;
      height: 120px;
      background: radial-gradient(circle at top, rgba(255,255,255,0.15), transparent 55%);
      pointer-events: none;
    }

    .wall-frame.shake {
      animation: wallShake 0.38s ease-out;
    }

    @keyframes wallShake {
      0%   { transform: translate3d(0,0,0); }
      20%  { transform: translate3d(-6px,-2px,0); }
      40%  { transform: translate3d(5px,3px,0); }
      60%  { transform: translate3d(-4px,2px,0); }
      80%  { transform: translate3d(3px,-2px,0); }
      100% { transform: translate3d(0,0,0); }
    }

    /* ØªØ§Ø¨Ù„ÙˆÙ‡Ø§ */
    .board {
      position: relative;
      flex: 1 1 calc(33.33% - 18px);
      min-width: 230px;
      max-width: 320px;
      height: 100px;
      border-radius: 16px;
      background:
        radial-gradient(circle at top, rgba(255,255,255,0.24), transparent 60%),
        linear-gradient(135deg,#7b4a1c,#4a2b12 45%,#3a220f);
      box-shadow:
        0 16px 26px rgba(0,0,0,0.9),
        inset 0 0 0 1px rgba(255,255,255,0.18);
      padding: 10px 12px;
      color: #fef5e6;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 14px;
      line-height: 1.7;
      transition:
        transform 0.15s ease,
        box-shadow 0.15s ease,
        filter 0.15s ease,
        background 0.15s ease,
        opacity 0.25s ease;
      overflow: hidden;
    }

    .board::before {
      /* Ù…ÛŒØ®â€ŒÙ‡Ø§ */
      content: "";
      position: absolute;
      top: 5px;
      left: 22px;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: radial-gradient(circle,#f5f5f5,#b0b0b0 60%,#555);
      box-shadow: 0 0 4px rgba(0,0,0,0.9);
    }
    .board::after {
      content: "";
      position: absolute;
      top: 5px;
      right: 22px;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: radial-gradient(circle,#f5f5f5,#b0b0b0 60%,#555);
      box-shadow: 0 0 4px rgba(0,0,0,0.9);
    }

   .board-text {
  font-size: 15px;
  font-weight: 700;
  line-height: 1.9;
  color: #fff;
}


    .board:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow:
        0 20px 36px rgba(0,0,0,1),
        inset 0 0 0 1px rgba(255,255,255,0.24);
      filter: brightness(1.05);
    }

  .board {
  background:
    radial-gradient(circle at top, rgba(255,255,255,0.2), transparent 55%),
    linear-gradient(135deg,#77552d,#3a2710 55%,#241707);
}

    .board.hit-good {
      animation: boardGoodHit 0.35s ease-out;
      box-shadow:
        0 0 18px rgba(183,255,155,0.8),
        0 18px 38px rgba(0,0,0,1);
    }

    .board.hit-bad {
      animation: boardBadHit 0.35s ease-out;
      box-shadow:
        0 0 18px rgba(255,150,150,0.7),
        0 18px 38px rgba(0,0,0,1);
      filter: brightness(0.8);
    }

    @keyframes boardGoodHit {
      0%   { transform: translateY(0) scale(1); }
      35%  { transform: translateY(4px) scale(0.97) rotate(-1.5deg); }
      70%  { transform: translateY(-4px) scale(1.03) rotate(1deg); }
      100% { transform: translateY(0) scale(1); }
    }

    @keyframes boardBadHit {
      0%   { transform: translateX(0); }
      20%  { transform: translateX(-5px); }
      40%  { transform: translateX(5px); }
      60%  { transform: translateX(-3px); }
      80%  { transform: translateX(3px); }
      100% { transform: translateX(0); }
    }

    .board-destroying {
      animation: boardDestroy 0.5s ease-in forwards;
    }

    @keyframes boardDestroy {
      0%   { transform: scale(1) translateY(0); opacity: 1; }
      40%  { transform: scale(1.03) translateY(-6px) rotate(-2deg); opacity: 1; }
      100% { transform: scale(0.8) translateY(26px) rotate(4deg); opacity: 0; }
    }

    .board.disabled {
      pointer-events: none;
      cursor: default;
    }

    /* Ø³ÙˆØ±Ø§Ø® Ø±ÙˆÛŒ Ø¯ÛŒÙˆØ§Ø± Ø¨Ø¹Ø¯ Ø§Ø² Ú©Ù†Ø¯Ù† ØªØ§Ø¨Ù„Ùˆ */
    .hole {
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: 0;
      transform: scale(0.7);
      transition: opacity 0.4s ease, transform 0.4s ease;
    }

    .hole.visible {
      opacity: 1;
      transform: scale(1);
    }

    .hole::before {
      content: "";
      position: absolute;
      inset: 12px;
      border-radius: 18px;
      background:
        radial-gradient(circle at center,
          rgba(15,15,15,0.9) 0%,
          rgba(5,5,5,1) 45%,
          rgba(0,0,0,0.9) 60%,
          transparent 80%);
      box-shadow:
        inset 0 0 35px rgba(0,0,0,1),
        0 0 30px rgba(0,0,0,0.9);
    }

    .hole::after {
      /* ØªØ±Ú©â€ŒÙ‡Ø§ÛŒ Ø§Ø·Ø±Ø§Ù Ø³ÙˆØ±Ø§Ø® */
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at 20% 20%, rgba(255,255,255,0.16) 0, transparent 40%),
        radial-gradient(circle at 80% 30%, rgba(255,255,255,0.12) 0, transparent 42%),
        radial-gradient(circle at 50% 80%, rgba(255,255,255,0.09) 0, transparent 40%);
      mix-blend-mode: screen;
      opacity: 0.65;
    }

    /* Ø°Ø±Ø§Øª ØªØ®Ø±ÛŒØ¨ */
    .chip {
      position: absolute;
      width: 10px;
      height: 12px;
      border-radius: 2px;
      background: linear-gradient(135deg,#f1d1a7,#b07a40);
      box-shadow: 0 0 4px rgba(0,0,0,0.8);
      opacity: 0;
      animation: chipFly 0.55s ease-out forwards;
    }

    @keyframes chipFly {
      0%   { opacity: 0; transform: translate(0,0) rotate(0deg); }
      10%  { opacity: 1; }
      100% { opacity: 0; transform: translate(var(--dx),var(--dy)) rotate(var(--rot)); }
    }

    /* Ú†Ú©Ø´ */
    .hammer {
      position: fixed;
      top: 120px;
      left: calc(50% + 550px);
      width: 150px;
      height: 150px;
      transform-origin: 20% 80%;
      transform: translate(-50%,0) rotate(-18deg);
      z-index: 10;
      pointer-events: none;
      filter: drop-shadow(0 12px 30px rgba(0,0,0,0.95));
      transition: left 0.18s ease-out, top 0.18s ease-out, transform 0.18s ease-out;
    }

    .hammer img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      pointer-events: none;
    }

    .hammer-hit {
      transform: translate(-50%,0) rotate(-50deg) scale(1.05);
    }

    /* Ù¾Ù†Ù„ Ø¢Ø±ÛŒØ§ Ù¾Ø§ÛŒÛŒÙ† ØµÙØ­Ù‡ */
    .aria-panel {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 10px;
      width: min(900px, 96vw);
      background: rgba(0,0,0,0.82);
      border-radius: 18px;
      padding: 10px 14px;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      backdrop-filter: blur(12px);
      box-shadow: 0 10px 26px rgba(0,0,0,1);
      z-index: 5;
      color: #fff;
    }

    .aria-avatar {
      width: 46px;
      height: 46px;
      border-radius: 50%;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0,0,0,0.9);
      flex-shrink: 0;
    }

    .aria-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
    }

    .aria-content { flex: 1; }

    .aria-name {
      font-size: 11px;
      opacity: 0.8;
      color: #b8ff7d;
      margin-bottom: 4px;
    }

  .aria-text {
  font-family: "Nunito", sans-serif;
  font-size: 22px;
  font-weight: 700;
  line-height: 1.9;
  color: #ffffff;
}


    .aria-text span.good { color: #b8ff7d; }
    .aria-text span.bad  { color: #ffb5b5; }

    /* ØµÙØ­Ù‡â€ŒÛŒ Ø´Ø±ÙˆØ¹ */
    .start-overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, rgba(0,0,0,0.7), rgba(0,0,0,0.96));
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #fff;
      z-index: 20;
      text-align: center;
      padding: 0 18px;
    }

    .start-title {
      font-size: 24px;
      margin-bottom: 10px;
    }

    .start-desc {
      font-size: 14px;
      max-width: 520px;
      line-height: 1.8;
      opacity: 0.92;
      margin-bottom: 18px;
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 10px 22px;
      font-size: 15px;
      cursor: pointer;
      box-shadow: 0 12px 22px rgba(0,0,0,0.9);
      transition: transform 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
      margin: 0 6px;
    }
    .btn-primary {
      background: linear-gradient(135deg,#b8ff6a,#46ff8f);
      color: #072313;
    }
    .btn-secondary {
      background: rgba(255,255,255,0.12);
      color: #fff;
    }
    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 28px rgba(0,0,0,1);
    }
    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 7px 14px rgba(0,0,0,0.85);
    }

    /* Ù¾Ø§ÛŒØ§Ù† Ø³Ù†Ø§Ø±ÛŒÙˆ */
    .end-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.75);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 30;
    }

    .end-modal {
      background: rgba(0,0,0,0.92);
      border-radius: 18px;
      padding: 18px 22px;
      width: min(420px, 90vw);
      backdrop-filter: blur(18px);
      box-shadow: 0 22px 40px rgba(0,0,0,1);
      text-align: center;
      color: #fff;
       position: relative;
  z-index: 50;
    }

    .end-title {
      font-size: 18px;
      margin-bottom: 8px;
    }

    .end-text {
      font-size: 14px;
      line-height: 1.8;
      margin-bottom: 16px;
      opacity: 0.96;
    }

    @media (max-width: 800px) {
      .wall-wrapper {
        top: 70px;
        height: calc(100vh - 240px);
      }
      .board {
        flex-basis: calc(50% - 18px);
        min-width: 180px;
        height: 90px;
        font-size: 13px;
      }
      .hammer {
        left: calc(70% + 300px);
        width: 75px;
        height: 75px;
      }
    }
    .star {
  width: 26px;
  height: 26px;
  background: url("star-off.png") center/contain no-repeat;
  opacity: .4;
  transition: .25s;
}
.star.active {
  background: url("star-on.png") center/contain no-repeat;
  opacity: 1;
  transform: scale(1.2);
  filter: drop-shadow(0 0 6px gold);
}
.stars-box {
  position: fixed;
  top: 70px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 8px;
  z-index: 30;
}


 .page-title {
    padding: 14px 24px 4px;
    font-size: 22px;
    font-weight: bold;
    text-align: center;
      color: #fffafa;
  }
.timer-box {
  position: fixed;
  top: 20px;
  left: 20px;
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 20px;
  background: #000000cc;
  border-radius: 20px;
  border: 1px solid #ffffff33;
  box-shadow: 0 8px 30px #000a;
  z-index: 40;
}

.hourglass {
  font-size: 28px;
  animation: flip 2s infinite linear;
}

.time-text {
  font-size: 28px;
  font-weight: 800;
   color: #fffafa;
}

.timer-warning .time-text {
  color: #ef4444;
}

@keyframes flip {
  0% { transform: rotate(0deg); }
  50% { transform: rotate(180deg); }
  100% { transform: rotate(360deg); }
}



    @media (max-width: 600px) {
      .board {
        flex-basis: 100%;
        min-width: 0;
      }
      .hammer {
        display: none; /* Ø§Ú¯Ø± Ø±ÙˆÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø§Ø°ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒ Ø§ÛŒÙ† Ø±Ø§ Ø¨Ø±Ø¯Ø§Ø±ÛŒ */
      }
    }
    .feedback-mark {
  position: absolute;
  font-size: 42px;
  font-weight: bold;
  color: white;
  opacity: 0;
  transform: scale(0.6);
  animation: popMark 0.45s ease-out forwards;
  z-index: 999;
}

@keyframes popMark {
  0% { opacity: 0; transform: scale(0.5); }
  60% { opacity: 1; transform: scale(1.25); }
  100% { opacity: 1; transform: scale(1); }
}

  </style>
</head>
<body>

<div class="backdrop"></div>

<div class="game-root">
  <!-- HUD Ø¨Ø§Ù„Ø§ -->
  <div class="top-hud">
    
   </div>
<div class="page-title">
 ÙÙˆØ§ÛŒØ¯ Ø¨Ø§Ø²ÛŒØ§ÙØª
</div>
<div class="stars-box" id="starsBox">
  <div class="star"></div>
  <div class="star"></div>
  <div class="star"></div>
  <div class="star"></div>
  <div class="star"></div>
</div>

<div class="timer-box" id="timerBox">
  <span class="hourglass">â³</span>
  <span class="time-text" id="timeText">01:00</span>
</div>

  <!-- Ø¯ÛŒÙˆØ§Ø± -->
  <div class="wall-wrapper">
    <div class="wall-frame" id="wallFrame">
      <div class="wall-inner" id="wallInner"><!-- ØªØ§Ø¨Ù„ÙˆÙ‡Ø§ Ø§ÛŒÙ†â€ŒØ¬Ø§ Ø¨Ø§ JS Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ --></div>
    </div>
  </div>


  <!-- Ú†Ú©Ø´ -->
  <div class="hammer" id="hammer">
    <!-- ØªØµÙˆÛŒØ± Ú†Ú©Ø´ Ø±Ø§ Ø®ÙˆØ¯Øª Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù† -->
    <img src="hammer.png" alt="Ú†Ú©Ø´">
  </div>

  <!-- Ù¾Ù†Ù„ Ø¢Ø±ÛŒØ§ -->
  <div class="aria-panel">
    <div class="aria-avatar">
      <img src="aria.png" alt="Ø¢Ø±ÛŒØ§">
    </div>
    <div class="aria-content">
      <div class="aria-name">Ø¢Ø±ÛŒØ§ â€“ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù¾Ø±Ø¯ÛŒØ³ Ø³Ø¨Ø²</div>
      <div class="aria-text" id="ariaText">
        Ø±ÙˆÛŒ Ø¯ÛŒÙˆØ§Ø± Ú†Ù†Ø¯ ØªØ§Ø¨Ù„Ùˆ Ø¢ÙˆÛŒØ²Ø§Ù† Ø´Ø¯Ù‡ Ú©Ù‡ Ø¨Ø¹Ø¶ÛŒâ€ŒØ´Ø§Ù† ÙÙˆØ§ÛŒØ¯ ÙˆØ§Ù‚Ø¹ÛŒ
        <span class="good">Ø¨Ø§Ø²ÛŒØ§ÙØª</span> Ø±Ø§ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ù†Ø¯ Ùˆ Ø¨Ø¹Ø¶ÛŒ ÙÙ‚Ø·
        <span class="bad">Ø´Ø¹Ø§Ø±Ù‡Ø§ÛŒ Ú¯Ù…Ø±Ø§Ù‡â€ŒÚ©Ù†Ù†Ø¯Ù‡</span> Ù‡Ø³ØªÙ†Ø¯. Ú©Ø§Ø± ØªÙˆ Ø§ÛŒÙ† Ø§Ø³Øª Ú©Ù‡
        ØªØ§Ø¨Ù„ÙˆÙ‡Ø§ÛŒ ØºÙ„Ø· Ø±Ø§ Ø¨Ø§ Ú†Ú©Ø´ Ø§Ø² Ø¯ÛŒÙˆØ§Ø± Ø¨Ú©Ù†ÛŒ ØªØ§ Ø¯ÛŒÙˆØ§Ø± Ø­Ù‚ÛŒÙ‚Øª ØªÙ…ÛŒØ² Ø´ÙˆØ¯.
       
      </div>
    </div>
  </div>

  <!-- ØµÙØ­Ù‡ Ø´Ø±ÙˆØ¹ -->
  <div class="start-overlay" id="startOverlay">
    <div class="start-title">Ø³Ù†Ø§Ø±ÛŒÙˆ Û´ â€“ Ø¯ÛŒÙˆØ§Ø± Ø­Ù‚ÛŒÙ‚Øª Ø¨Ø§Ø²ÛŒØ§ÙØª</div>
    <div class="start-desc">
      Ø¨Ù‡ Ù†Ø¸Ø± ØªÙˆ ÙÙˆØ§ÛŒØ¯ ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ø§Ø²ÛŒØ§ÙØª Ú†ÛŒØ³ØªØŸ<br>
      Ø±ÙˆÛŒ Ø§ÛŒÙ† Ø¯ÛŒÙˆØ§Ø± Ù‡Ù… Ø¬Ù…Ù„Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø³Øª Ø¢ÙˆÛŒØ²Ø§Ù† Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯ Ùˆ Ù‡Ù… Ø§Ø¯Ø¹Ø§Ù‡Ø§ÛŒ ØºÙ„Ø· Ùˆ Ø§ØºØ±Ø§Ù‚â€ŒØ¢Ù…ÛŒØ².
      Ø¨Ø§ Ø¶Ø±Ø¨Ù‡â€ŒÛŒ Ú†Ú©Ø´ØŒ ØªØ§Ø¨Ù„ÙˆÙ‡Ø§ÛŒ ØºÙ„Ø· Ø±Ø§ Ø¨Ú©Ù†
    </div>
    <button class="btn btn-primary" id="btnStart">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
  </div>

<div class="end-backdrop" id="endBackdrop">
  <div class="end-modal">
    <h3 id="endTitle">Ù¾Ø§ÛŒØ§Ù† Ù…Ø±Ø­Ù„Ù‡</h3>
    <p id="endText"></p>
    <button class="btn btn-primary" id="btnNext">Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯</button>
  </div>
</div>


<script>
  // ---------- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„ÛŒ ----------
  const REQUIRED_WRONG = 5; // Ø¨Ø§ÛŒØ¯ 5 Ø¬Ù…Ù„Ù‡ Ø§Ø´ØªØ¨Ø§Ù‡ Ù¾ÛŒØ¯Ø§ Ø´ÙˆØ¯ (5 Ø³ØªØ§Ø±Ù‡)
  const TOTAL_STARS = 5;
const starsBox = document.getElementById("starsBox");

  const ariaText = document.getElementById("ariaText");
  const wallInner = document.getElementById("wallInner");
  const wallFrame = document.getElementById("wallFrame");
  const hammerEl = document.getElementById("hammer");
  const startOverlay = document.getElementById("startOverlay");
  const endBackdrop = document.getElementById("endBackdrop");
  const endTitle = document.getElementById("endTitle");
  const endText = document.getElementById("endText");
  const btnBack = document.getElementById("btnBack");
  const btnRetry = document.getElementById("btnRetry");
  const btnStart = document.getElementById("btnStart");
  const btnNext = document.getElementById("btnNext");
  const timerBox = document.getElementById("timerBox");
  const timeText = document.getElementById("timeText");
const stars = Array.from(document.querySelectorAll("#starsBox .star"));




  let starsEarned = 0;         // ØªØ¹Ø¯Ø§Ø¯ Ø³ØªØ§Ø±Ù‡ (0..5)
  let gameRunning = false;
  let gameOverFlag = false;
  let remainingWrong = 0;      // ØªØ¹Ø¯Ø§Ø¯ ØªØ§Ø¨Ù„ÙˆÙ‡Ø§ÛŒ ØºÙ„Ø· Ø¯Ø± Ø§ÛŒÙ† Ø¯ÙˆØ±
  let timeLeft = 60;
  let timer = null;

  // --- Web Audio Engine ---
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  function playSimple(freqStart, freqEnd, duration, type="sine", gainVal=0.4) {
    try {
      if (audioCtx.state === "suspended") audioCtx.resume().catch(()=>{});
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = type;
      o.frequency.setValueAtTime(freqStart, audioCtx.currentTime);
      o.frequency.exponentialRampToValueAtTime(freqEnd, audioCtx.currentTime + duration*0.7);
      g.gain.setValueAtTime(gainVal, audioCtx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
      o.connect(g).connect(audioCtx.destination);
      o.start();
      o.stop(audioCtx.currentTime + duration);
    } catch(e) {}
  }

  function playCorrect() { playSimple(420, 1200, 0.22, "triangle", 0.28); }
  function playWrong()   { playSimple(260, 150, 0.25, "sawtooth", 0.35); }
  function playHit() {
    try {
      if (audioCtx.state === "suspended") audioCtx.resume().catch(()=>{});
      const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.07, audioCtx.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i=0;i<data.length;i++) data[i] = (Math.random()*2-1) * (1 - i/data.length);
      const src = audioCtx.createBufferSource();
      src.buffer = buffer;
      const g = audioCtx.createGain();
      g.gain.setValueAtTime(0.7, audioCtx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.07);
      src.connect(g).connect(audioCtx.destination);
      src.start();
    } catch(e) {}
  }

const titleEl = document.querySelector(".page-title");
if (titleEl && starsBox) {
  titleEl.insertAdjacentElement("afterend", starsBox);
}
starsBox.style.display = "flex";
starsBox.style.justifyContent = "center";
starsBox.style.alignItems = "center";
starsBox.style.gap = "10px";
starsBox.style.marginTop = "10px";
starsBox.style.marginBottom = "10px";

stars.forEach((s, i) => {
  s.style.display = i < 5 ? "" : "none";
});







  function updateStars() {
    stars.forEach((s, i) => s.classList.toggle("active", i < starsEarned));
  }

  function setAria(html) {
    ariaText.innerHTML = html;
  }

  // ===================== ØªØ§ÛŒÙ…Ø± =====================
  function startTimer() {
    clearInterval(timer);
    timeLeft = 60;
    timeText.textContent = "01:00";
    timerBox.classList.remove("timer-warning");

    timer = setInterval(() => {
      if (!gameRunning || gameOverFlag) return;

      timeLeft--;
      const m = String(Math.floor(timeLeft / 60)).padStart(2,"0");
      const s = String(timeLeft % 60).padStart(2,"0");
      timeText.textContent = `${m}:${s}`;

      if (timeLeft <= 10) timerBox.classList.add("timer-warning");
      if (timeLeft <= 0) endGame(false);
    }, 1000);
  }

  // ---------- Ø¯Ø§Ø¯Ù‡ ØªØ§Ø¨Ù„ÙˆÙ‡Ø§ ----------
  const boardsData = [
    // Ø¯Ø±Ø³Øª
    { text:"ØµØ±ÙÙ‡ Ø¬ÙˆÛŒÛŒ Ø¯Ø± Ù‡Ø²ÛŒÙ†Ù‡ Ùˆ Ø²Ù…Ø§Ù† Ù…Ø¯ÛŒØ±ÛŒØª Ø²Ø¨Ø§Ù„Ù‡ ØªÙˆØ³Ø· Ø´Ù‡Ø±Ø¯Ø§Ø±ÛŒ", correct:true },
    { text:"Ú©Ø§Ù‡Ø´ Ø­Ø¬Ù… Ù¾Ø³Ù…Ø§Ù†Ø¯Ù‡Ø§ÛŒ Ø±Ø§Ù‡ÛŒÙ Ù…Ø­Ù„ Ø¯ÙÙ† Ùˆ Ø³ÙˆØ²Ø§Ù†Ø¯Ù†", correct:true },
    { text:"Ú©Ø§Ù‡Ø´ Ø¢Ù„ÙˆØ¯Ú¯ÛŒ Ù…Ø­ÛŒØ· Ø²ÛŒØ³Øª", correct:true },
    { text:"Ú©Ø§Ù‡Ø´ ØªØ¹Ø¯Ø§Ø¯ Ø²Ø¨Ø§Ù„Ù‡ Ú¯Ø±Ø¯ Ù‡Ø§", correct:true },
    { text:"Ú©Ø§Ù‡Ø´ ØªÙˆÙ„ÛŒØ¯ Ø²Ø¨Ø§Ù„Ù‡", correct:true },
    { text:"Ø¯Ø±Ø¢Ù…Ø¯Ø²Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø´Ù‡Ø±ÙˆÙ†Ø¯Ø§Ù†", correct:true },
    { text:"Ú©Ø§Ù‡Ø´ Ù…Ø­Ù„ Ù‡Ø§ÛŒ Ø¯ÙÙ† Ø²Ø¨Ø§Ù„Ù‡", correct:true },

    // ØºÙ„Ø· / Ø§ØºØ±Ø§Ù‚â€ŒØ¢Ù…ÛŒØ²
    { text:"Ø¨Ø§Ø²ÛŒØ§ÙØªØŒ Ù…ØµØ±Ù Ø¨ÛŒâ€ŒØ±ÙˆÛŒÙ‡ Ø±Ø§ ØªÙˆØ¬ÛŒÙ‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯", correct:false },
    { text:"ÙØ±Ø§ÛŒÙ†Ø¯ Ø¨Ø§Ø²ÛŒØ§ÙØª Ø¨Ø¯ÙˆÙ† Ù…ØµØ±Ù Ø§Ù†Ø±Ú˜ÛŒ Ùˆ Ø¢Ù„ÙˆØ¯Ú¯ÛŒ Ø§Ø³Øª", correct:false },
    { text:"Ø¨Ø§ Ø¨Ø§Ø²ÛŒØ§ÙØª Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ Ú©Ø§Ù‡Ø´ ØªÙˆÙ„ÛŒØ¯ Ø²Ø¨Ø§Ù„Ù‡ Ù†ÛŒØ³Øª", correct:false },
    { text:"Ù‡Ù…Ù‡ Ø²Ø¨Ø§Ù„Ù‡â€ŒÙ‡Ø§ Ù‡Ù…ÛŒØ´Ù‡ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²ÛŒØ§ÙØªâ€ŒØ§Ù†Ø¯", correct:false },
    { text:"Ø¨Ø§Ø²ÛŒØ§ÙØª Ø¨Ø§Ø¹Ø« Ø§ÙØ²Ø§ÛŒØ´ Ø²Ø¨Ø§Ù„Ù‡â€ŒØ³ÙˆØ²ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯", correct:false },
    { text:"Ø¨Ø§Ø¹Ø« Ø§ÙØ²Ø§ÛŒØ´ Ø²Ø¨Ø§Ù„Ù‡â€ŒØ³ÙˆØ²ÛŒ Ø¯Ø± Ø´Ù‡Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯", correct:false },
    { text:"Ø¨Ø§Ø²ÛŒØ§ÙØª Ù‡Ù…ÛŒØ´Ù‡ Ù¾Ø±Ù…ØµØ±Ùâ€ŒØªØ± Ø§Ø² ØªÙˆÙ„ÛŒØ¯ Ø§ÙˆÙ„ÛŒÙ‡ Ø§Ø³Øª", correct:false },
    { text:"Ø¨Ø§Ø²ÛŒØ§ÙØª Ø¨Ù‡â€ŒØªÙ†Ù‡Ø§ÛŒÛŒ Ù‡Ù…Ù‡ Ù…Ø´Ú©Ù„Ø§Øª Ù…Ø­ÛŒØ·â€ŒØ²ÛŒØ³ØªÛŒ Ø±Ø§ Ø­Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯", correct:false },
  ];

  function shuffle(arr) {
    const a = arr.slice();
    for (let i = a.length-1; i>0; i--) {
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]] = [a[j],a[i]];
    }
    return a;
  }

  function buildWall() {
    wallInner.innerHTML = "";

    // 5 ØªØ§ ØºÙ„Ø· + 4 ØªØ§ Ø¯Ø±Ø³Øª â†’ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ 9 ØªØ§Ø¨Ù„Ùˆ
    const wrongs = shuffle(boardsData.filter(b => !b.correct)).slice(0, 5);
    const rights = shuffle(boardsData.filter(b => b.correct)).slice(0, 4);
    const selected = shuffle([...wrongs, ...rights]);

    remainingWrong = 5;

    selected.forEach((b) => {
      const board = document.createElement("div");
      board.className = "board";
      board.dataset.correct = b.correct ? "true" : "false";

      const text = document.createElement("div");
      text.className = "board-text";
      text.textContent = b.text;

      const hole = document.createElement("div");
      hole.className = "hole";

      board.appendChild(text);
      board.appendChild(hole);
      wallInner.appendChild(board);
    });
  }

  function showCheckMark(boardEl) {
    const mark = document.createElement("div");
    mark.className = "feedback-mark";
    mark.textContent = "âœ”ï¸";
    boardEl.appendChild(mark);
    setTimeout(() => mark.remove(), 650);
  }
  function showXMark(boardEl) {
    const mark = document.createElement("div");
    mark.className = "feedback-mark";
    mark.textContent = "âœ–ï¸";
    boardEl.appendChild(mark);
    setTimeout(() => mark.remove(), 650);
  }

  function triggerHammerOn(boardEl) {
    if (!hammerEl) return;
    const rect = boardEl.getBoundingClientRect();
    const baseX = rect.left + rect.width * 0.12;
    const baseY = rect.top - 10;

    hammerEl.style.left = (baseX) + "px";
    hammerEl.style.top = (baseY) + "px";

    hammerEl.classList.remove("hammer-hit");
    void hammerEl.offsetWidth;
    hammerEl.classList.add("hammer-hit");

    setTimeout(() => {
      hammerEl.classList.remove("hammer-hit");
      hammerEl.style.left = "calc(50% + 420px)";
      hammerEl.style.top = "120px";
    }, 230);
  }

  function spawnChips(boardEl) {
    const rect = boardEl.getBoundingClientRect();
    const containerRect = wallInner.getBoundingClientRect();

    const baseX = rect.left - containerRect.left;
    const baseY = rect.top - containerRect.top;

    const chipsCount = 9 + Math.floor(Math.random()*5);
    for (let i=0; i<chipsCount; i++) {
      const chip = document.createElement("div");
      chip.className = "chip";

      const localX = baseX + rect.width/2 + (Math.random()*40 - 20);
      const localY = baseY + rect.height/2 + (Math.random()*10 - 5);
      chip.style.left = localX + "px";
      chip.style.top = localY + "px";

      const dx = (Math.random()*80 - 40) + "px";
      const dy = (30 + Math.random()*40) + "px";
      const rot = (Math.random()*140 - 70) + "deg";
      chip.style.setProperty("--dx", dx);
      chip.style.setProperty("--dy", dy);
      chip.style.setProperty("--rot", rot);

      wallInner.appendChild(chip);
      setTimeout(() => chip.remove(), 600);
    }
  }

  function showHole(boardEl) {
    const hole = boardEl.querySelector(".hole");
    if (!hole) return;
    hole.classList.add("visible");
  }

  function shakeWall() {
    wallFrame.classList.remove("shake");
    void wallFrame.offsetWidth;
    wallFrame.classList.add("shake");
    setTimeout(() => wallFrame.classList.remove("shake"), 420);
  }

  function handleBoardClick(boardEl) {
    if (!gameRunning || gameOverFlag) return;
    if (!boardEl || boardEl.classList.contains("disabled")) return;

    const isCorrectBoard = boardEl.dataset.correct === "true";

    try { if (audioCtx.state === "suspended") audioCtx.resume().catch(()=>{}); } catch(e) {}

    triggerHammerOn(boardEl);
    playHit();

    if (!isCorrectBoard) {
      // ØµØ­ÛŒØ­: ØªØ§Ø¨Ù„Ùˆ ØºÙ„Ø·
      boardEl.classList.add("hit-good","disabled");
      boardEl.style.backgroundColor = "rgba(0,255,0,0.35)";
      boardEl.style.border = "2px solid rgba(0,255,0,0.85)";
      boardEl.style.boxShadow = "0 0 14px rgba(0,255,0,0.85)";
      showCheckMark(boardEl);

      playCorrect();
      shakeWall();
      spawnChips(boardEl);
      showHole(boardEl);
      boardEl.classList.add("board-destroying");

      starsEarned = Math.min(TOTAL_STARS, starsEarned + 1);
      updateStars();

      setAria(`<span class="good">Ø¢ÙØ±ÛŒÙ†!</span> Ø§ÛŒÙ† Ø¬Ù…Ù„Ù‡ ÛŒÚ© Ø¨Ø§ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø¯Ø±Ø¨Ø§Ø±Ù‡â€ŒÛŒ Ø¨Ø§Ø²ÛŒØ§ÙØª Ø¨ÙˆØ¯. `);

      remainingWrong--;
      if (remainingWrong <= 0) {
        setTimeout(() => endGame(true), 650);
      }
    } else {
      // Ø§Ø´ØªØ¨Ø§Ù‡: ØªØ§Ø¨Ù„Ùˆ Ø¯Ø±Ø³Øª
      boardEl.classList.add("hit-bad");
      boardEl.style.border = "2px solid rgba(255,0,0,0.85)";
      boardEl.style.boxShadow = "0 0 14px rgba(255,0,0,0.85)";
      showXMark(boardEl);
      playWrong();
      shakeWall();

      setAria(`<span class="bad">Ø§ÛŒÙ† ØªØ§Ø¨Ù„Ùˆ Ø¯Ø±Ø³Øª Ø¨ÙˆØ¯!</span> `);

      setTimeout(() => {
        boardEl.style.border = "";
        boardEl.style.boxShadow = "";
      }, 600);
    }
  }

  function endGame() {
  gameRunning = false;
  gameOverFlag = true;
  clearInterval(timer);

  localStorage.setItem("stage4Stars", starsEarned);

  endTitle.textContent = "Ù¾Ø§ÛŒØ§Ù† Ù…Ø±Ø­Ù„Ù‡ ğŸ‰";
  endText.innerHTML = `
    Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§: <b>${starsEarned}</b> Ø§Ø² 5 â­<br>
    Ø§Ù…ØªÛŒØ§Ø² Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ âœ…
  `;
btnNext.style.display = "inline-block";

  endBackdrop.style.display = "flex";
}



  function initGame() {
    starsEarned = 0;
    gameRunning = false;
    gameOverFlag = false;
    updateStars();
    buildWall();

    setAria(
      " " +
      "ØªØ§Ø¨Ù„ÙˆÙ‡Ø§ÛŒÛŒ Ø±Ø§ Ú©Ù‡ Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ø§ØºØ±Ø§Ù‚â€ŒØ¢Ù…ÛŒØ² ÛŒØ§ Ú©Ø§Ù…Ù„Ø§Ù‹ Ø§Ø´ØªØ¨Ø§Ù‡ Ù‡Ø³ØªÙ†Ø¯ Ø¨Ø§ Ú†Ú©Ø´ Ø§Ø² Ø¯ÛŒÙˆØ§Ø± Ø¨Ú©Ù†. " +
      ""
    );

    if (btnNext) btnNext.style.display = "none";
  }

  // Ø±ÙˆÛŒØ¯Ø§Ø¯ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø¯ÛŒÙˆØ§Ø±
  wallInner.addEventListener("click", (e) => {
    const boardEl = e.target.closest(".board");
    if (!boardEl) return;
    handleBoardClick(boardEl);
  });

  // Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ
  btnStart.addEventListener("click", () => {
    startOverlay.style.display = "none";
    gameRunning = true;
    startTimer();
  });

  // ÙÙ‚Ø· ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ Ø¨Ø§ Ú©Ù„ÛŒÚ©
  if (btnNext) {
  btnNext.onclick = () => {
  window.location.href = "stage1-5.html";
};
}
  // Ø´Ø±ÙˆØ¹ Ø§ÙˆÙ„ÛŒÙ‡
  initGame();
</script>


</body>
</html>
